<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gest√£o - M√≥veis Bonaf√©</title>
    <meta name="description" content="Sistema de gest√£o do cat√°logo de m√≥veis - M√≥veis Bonaf√©">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            background: white;
            color: #1A1A1A;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .header {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px 0;
            border-bottom: 3px solid #F2C41B;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .logo {
            font-size: 2.5em;
            font-weight: bold;
            color: #F2C41B;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            color: #666;
            font-size: 1.1em;
            margin-top: 5px;
        }
        
        .btn {
            background: #F2C41B;
            color: #1A1A1A;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
        }
        
        .btn:hover {
            background: #E6B800;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(242, 196, 27, 0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .main-content {
            padding: 40px 0;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        
        .product-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 1px solid #E6D5A8;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
            border-color: #F2C41B;
        }
        
        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .category-badge {
            background: #FFF8E7;
            color: #8B6914;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
            border: 1px solid #E6D5A8;
        }
        
        .price {
            font-size: 1.4em;
            font-weight: bold;
            color: #F2C41B;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .product-name {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 10px;
            color: #1A1A1A;
        }
        
        .product-description {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .features {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .feature-tag {
            background: #F8F9FA;
            color: #495057;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            border: 1px solid #DEE2E6;
        }
        
        .colors {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .color-label {
            font-size: 0.9em;
            color: #666;
        }
        
        .color-dots {
            display: flex;
            gap: 6px;
        }
        
        .color-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #E6D5A8;
        }

        .color-dot-large {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #ddd;
            margin: 0 auto;
        }

        /* Drag and Drop Styles */
        .reorder-item {
            position: relative;
            background: white;
            border: 2px solid #E0E0E0;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            cursor: move;
            transition: all 0.2s ease;
            user-select: none;
        }

        .reorder-item:hover {
            border-color: #2c5282;
            box-shadow: 0 2px 8px rgba(44, 82, 130, 0.1);
        }

        .reorder-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .reorder-controls {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 2px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .reorder-item:hover .reorder-controls {
            opacity: 1;
        }

        .reorder-btn {
            background: #2c5282;
            color: white;
            border: none;
            border-radius: 4px;
            width: 24px;
            height: 24px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
        }

        .reorder-btn:hover {
            background: #1a365d;
        }

        .reorder-btn:last-child {
            background: #dc3545;
        }

        .reorder-btn:last-child:hover {
            background: #c82333;
        }

        .image-reorder-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .color-reorder-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .standard-color-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .standard-color-preview {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-actions-inline button {
            padding: 4px 8px;
            font-size: 12px;
            margin-left: 5px;
        }
        
        .actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #E6D5A8;
        }
        
        .modal-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #F2C41B;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1A1A1A;
        }
        
        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #E6D5A8;
            border-radius: 8px;
            font-size: 16px;
            background: #FFFBF0;
        }
        
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #F2C41B;
            box-shadow: 0 0 0 3px rgba(242, 196, 27, 0.1);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .colors-section {
            border: 2px solid #E6D5A8;
            border-radius: 8px;
            padding: 15px;
            background: #FFFBF0;
        }
        
        .color-item {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #E6D5A8;
        }
        
        .color-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #E6D5A8;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .color-preview {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid #E6D5A8;
        }
        
        .remove-color {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .features-section, .images-section {
            border: 2px solid #E6D5A8;
            border-radius: 8px;
            padding: 15px;
            background: #FFFBF0;
        }
        
        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .image-item {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #E6D5A8;
        }
        
        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .feature-item {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .feature-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #E6D5A8;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .remove-feature {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #E6D5A8;
            border-top: 4px solid #F2C41B;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .github-section {
            background: white;
            border: 2px solid #E6D5A8;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .github-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #F2C41B;
            margin-bottom: 15px;
        }
        
        .stats {
            background: white;
            border: 2px solid #E6D5A8;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .stats-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #F2C41B;
            margin-bottom: 10px;
        }

        .status-indicators {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
            border: 2px solid;
            transition: all 0.3s ease;
        }

        .status-online {
            background: #E8F5E8;
            color: #155724;
            border-color: #28a745;
        }

        .status-offline {
            background: #F8D7DA;
            color: #721c24;
            border-color: #dc3545;
        }

        .status-warning {
            background: #FFF3CD;
            color: #856404;
            border-color: #ffc107;
        }

        .status-icon {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-icon.online {
            background: #28a745;
        }

        .status-icon.offline {
            background: #dc3545;
        }

        .status-icon.warning {
            background: #ffc107;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .github-warning {
            background: #FFF3CD;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }

        .github-warning-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .github-warning-text {
            color: #856404;
            font-size: 0.9em;
        }

        .management-section {
            background: white;
            border: 2px solid #E6D5A8;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #F2C41B;
            margin-bottom: 15px;
        }

        .category-actions, .color-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .category-list, .standard-color-list {
            margin-top: 15px;
        }

        .category-item, .standard-color-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: #FFFBF0;
            border: 1px solid #E6D5A8;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .category-name {
            font-weight: 500;
            color: #1A1A1A;
        }

        .category-actions-inline {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.8em;
            border-radius: 4px;
        }

        .standard-color-preview {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-dot-large {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid #E6D5A8;
        }

        .draggable-item {
            cursor: move;
            transition: all 0.3s ease;
            position: relative;
        }

        .draggable-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .draggable-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .drag-handle {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 20px;
            height: 20px;
            background: rgba(242, 196, 27, 0.9);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            cursor: grab;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .draggable-item:hover .drag-handle {
            opacity: 1;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .reorder-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .draggable-item:hover .reorder-controls {
            opacity: 1;
        }

        .drop-zone {
            min-height: 40px;
            border: 2px dashed #E6D5A8;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            margin: 5px 0;
        }

        .drop-zone.drag-over {
            border-color: #F2C41B;
            background: #FFFBF0;
            color: #F2C41B;
        }

        .image-reorder-container, .color-reorder-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .reorder-item {
            position: relative;
            border: 2px solid #E6D5A8;
            border-radius: 8px;
            padding: 8px;
            background: white;
            cursor: move;
            transition: all 0.3s ease;
        }

        .reorder-item:hover {
            border-color: #F2C41B;
            transform: scale(1.05);
        }

        .reorder-item.dragging {
            opacity: 0.5;
            transform: scale(0.95) rotate(5deg);
        }

        .reorder-controls {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 2px;
        }

        .reorder-btn {
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 3px;
            width: 20px;
            height: 20px;
            font-size: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .reorder-btn:hover {
            background: rgba(0,0,0,0.9);
        }
        
        @media (max-width: 768px) {
            .header-content {
                text-align: center;
            }
            
            .logo {
                font-size: 2em;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .modal-content {
                margin: 10% auto;
                width: 95%;
            }
            
            .status-indicators {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }
            
            .status-indicator {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div>
                    <h1 class="logo">Gest√£o - M√≥veis Bonaf√©</h1>
                    <p class="subtitle">Administra√ß√£o do Cat√°logo</p>
                </div>
                <div>
                    <a href="./index.html" class="btn btn-secondary">üìñ Ver Cat√°logo</a>
                    <button class="btn" onclick="openAddModal()">‚ûï Adicionar Produto</button>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <!-- Status Indicators -->
            <div class="status-indicators">
                <div id="connectionStatus" class="status-indicator status-offline">
                    <div class="status-icon offline"></div>
                    <span>Verificando conex√£o...</span>
                </div>
                <div id="githubStatus" class="status-indicator status-warning">
                    <div class="status-icon warning"></div>
                    <span>Token n√£o configurado</span>
                </div>
            </div>

            <!-- GitHub Warning -->
            <div id="githubWarning" class="github-warning">
                <div class="github-warning-title">
                    <span>‚ö†Ô∏è</span>
                    <span>Token GitHub n√£o configurado</span>
                </div>
                <div class="github-warning-text">
                    Configure o token GitHub abaixo para sincronizar produtos e fazer upload de imagens automaticamente.
                </div>
            </div>

            <div class="github-section">
                <h3 class="github-title">‚öôÔ∏è Configura√ß√£o GitHub</h3>
                <form style="display: contents;">
                    <div class="form-group">
                        <label class="form-label">Token GitHub (para upload de imagens):</label>
                        <input type="password" id="githubToken" class="form-input" placeholder="ghp_xxxxxxxxxxxxxxxxxx" autocomplete="current-password">
                        <button type="button" class="btn" onclick="saveGitHubToken()" style="margin-top: 10px;">Salvar Token</button>
                    </div>
                </form>
                    <div style="background: #E8F5E8; padding: 15px; border-radius: 6px; margin-top: 15px; border-left: 4px solid #28a745;">
                        <h4 style="margin: 0 0 8px 0; color: #155724; font-size: 1em;">Como funciona a sincroniza√ß√£o:</h4>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9em; color: #155724;">
                            <li>Configure o token UMA √öNICA VEZ neste dispositivo</li>
                            <li>Todos os dispositivos ver√£o automaticamente os produtos</li>
                            <li>Clientes N√ÉO precisam configurar nada</li>
                            <li>Imagens ficam dispon√≠veis para todos automaticamente</li>
                        </ul>
                    </div>
                    <small style="color: #666; font-size: 0.9em; display: block; margin-top: 10px;">
                        Token necess√°rio para fazer upload de imagens para o reposit√≥rio GitHub
                    </small>
                    <div id="tokenStatus" style="margin-top: 10px; font-size: 0.9em;"></div>
                </div>
            </div>

            <!-- Category Management Section -->
            <div class="management-section">
                <h3 class="section-title">üìÇ Gerenciar Categorias</h3>
                <div class="category-actions">
                    <button class="btn" onclick="openCategoryModal()">‚ûï Nova Categoria</button>
                    <button class="btn btn-secondary" onclick="toggleCategoryList()">üìã Ver Categorias</button>
                </div>
                <div id="categoryList" class="category-list" style="display: none;">
                    <div id="categoryContainer"></div>
                </div>
            </div>

            <!-- Standard Colors Section -->
            <div class="management-section">
                <h3 class="section-title">üé® Cores Padr√£o</h3>
                <div class="color-actions">
                    <button class="btn" onclick="openStandardColorModal()">‚ûï Nova Cor</button>
                    <button class="btn btn-secondary" onclick="toggleStandardColorList()">üé® Ver Cores</button>
                </div>
                <div id="standardColorList" class="standard-color-list" style="display: none;">
                    <div id="standardColorContainer"></div>
                </div>
            </div>

            <div class="stats">
                <h3 class="stats-title">üìä Estat√≠sticas</h3>
                <p>Total de produtos: <strong id="totalProducts">0</strong></p>
                <p>Categorias: <strong id="totalCategories">0</strong></p>
                <p>Cores padr√£o: <strong id="totalStandardColors">0</strong></p>
            </div>

            <div id="loadingState" class="loading">
                <div class="spinner"></div>
                <p>Carregando produtos...</p>
            </div>

            <div id="productsContainer" class="products-grid" style="display: none;"></div>
            
            <div id="emptyState" class="empty-state" style="display: none;">
                <h3>Nenhum produto cadastrado</h3>
                <p>Comece adicionando o primeiro produto ao cat√°logo</p>
                <button class="btn" onclick="openAddModal()">‚ûï Adicionar Primeiro Produto</button>
            </div>
        </div>
    </main>

    <!-- Modal para adicionar/editar produto -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Adicionar Produto</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <form id="productForm">
                <div class="form-group">
                    <label class="form-label">Nome do Produto:</label>
                    <input type="text" id="productName" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Descri√ß√£o:</label>
                    <textarea id="productDescription" class="form-textarea" required></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Imagens do Produto:</label>
                    <div class="images-section">
                        <input type="file" id="imageUpload" accept="image/jpeg,image/jpg,image/png,image/webp" multiple style="margin-bottom: 10px;">
                    <small style="color: #666; display: block; margin-bottom: 10px;">
                        Imagens ser√£o mantidas em qualidade m√°xima. Formatos suportados: JPG, PNG, WebP
                    </small>
                        <button type="button" class="btn" onclick="uploadImages()">üì§ Upload Imagens</button>
                        <div id="uploadStatus" style="margin-top: 10px; font-size: 0.9em;"></div>
                        <div id="imagesContainer" style="margin-top: 15px;">
                            <div class="image-reorder-container" id="imagesList"></div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Categoria:</label>
                    <select id="productCategory" class="form-select" required>
                        <option value="">Selecione uma categoria</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Cores Dispon√≠veis:</label>
                    <div class="colors-section">
                        <div style="margin-bottom: 10px;">
                            <label class="form-label" style="font-size: 0.9em;">Cores Padr√£o:</label>
                            <select id="standardColorSelect" class="form-select" style="margin-bottom: 10px;">
                                <option value="">Selecione uma cor padr√£o para adicionar</option>
                            </select>
                            <button type="button" class="btn btn-secondary" onclick="addStandardColor()" style="margin-right: 10px;">‚ûï Adicionar Cor Padr√£o</button>
                            <button type="button" class="btn" onclick="addCustomColor()">üé® Nova Cor Personalizada</button>
                        </div>
                        <div class="color-reorder-container" id="colorsContainer"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Caracter√≠sticas:</label>
                    <div class="features-section">
                        <div id="featuresContainer"></div>
                        <button type="button" class="btn" onclick="addFeature()">‚ûï Adicionar Caracter√≠stica</button>
                    </div>
                </div>

                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 30px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                    <button type="submit" class="btn">Salvar Produto</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Sample products data
        const sampleProducts = [
            {
                id: 1,
                name: "Sof√° Moderno 3 Lugares",
                description: "Sof√° confort√°vel com design moderno, estofado em tecido de alta qualidade.",
                images: [],
                category: "Sof√°s",
                colors: [
                    { name: "Cinza Claro", hex: "#D3D3D3" },
                    { name: "Azul Marinho", hex: "#000080" }
                ],
                features: ["3 lugares", "Estofado em tecido", "Estrutura em madeira", "Almofadas soltas"]
            },
            {
                id: 2,
                name: "Poltrona Relax Premium",
                description: "Poltrona reclin√°vel com sistema de massagem e aquecimento integrado.",
                price: "R$ 3.299,00",
                category: "Poltronas",
                colors: [
                    { name: "Couro Marrom", hex: "#8B4513" },
                    { name: "Preto", hex: "#000000" }
                ],
                features: ["Reclin√°vel", "Sistema de massagem", "Aquecimento", "Couro sint√©tico"]
            },
            {
                id: 3,
                name: "Mesa de Jantar Extens√≠vel",
                description: "Mesa de jantar em madeira maci√ßa com sistema de extens√£o para 8 pessoas.",
                price: "R$ 1.899,00",
                category: "Mesas",
                colors: [
                    { name: "Mogno", hex: "#CD853F" },
                    { name: "Carvalho", hex: "#DEB887" }
                ],
                features: ["Madeira maci√ßa", "Extens√≠vel", "Para 8 pessoas", "Acabamento verniz"]
            },
            {
                id: 4,
                name: "Cadeira Ergon√¥mica Office",
                description: "Cadeira de escrit√≥rio com apoio lombar ajust√°vel e rod√≠zios silenciosos.",
                price: "R$ 899,00",
                category: "Cadeiras",
                colors: [
                    { name: "Preto", hex: "#000000" },
                    { name: "Cinza", hex: "#808080" }
                ],
                features: ["Ergon√¥mica", "Apoio lombar", "Rod√≠zios silenciosos", "Altura regul√°vel"]
            },
            {
                id: 5,
                name: "Estante Biblioteca 5 Prateleiras",
                description: "Estante moderna com 5 prateleiras e compartimentos para livros e decora√ß√£o.",
                price: "R$ 1.299,00",
                category: "Estantes",
                colors: [
                    { name: "Branco", hex: "#FFFFFF" },
                    { name: "Amadeirado", hex: "#DEB887" }
                ],
                features: ["5 prateleiras", "Design moderno", "F√°cil montagem", "MDF 18mm"]
            },
            {
                id: 6,
                name: "Cama Box Queen Size",
                description: "Cama box queen com colch√£o de molas ensacadas e pillow top.",
                price: "R$ 2.799,00",
                category: "Camas",
                colors: [
                    { name: "Bege", hex: "#F5F5DC" },
                    { name: "Cinza Escuro", hex: "#2F4F4F" }
                ],
                features: ["Queen size", "Molas ensacadas", "Pillow top", "Base box"]
            }
        ];

        // Load products from GitHub first, then localStorage as fallback
        async function loadProducts() {
            const token = localStorage.getItem('githubToken');
            
            if (token) {
                try {
                    const response = await fetch('https://api.github.com/repos/MoveisBonafe/Catalogo-Moveis-Bonafe/contents/docs/products.json', {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        const decodedContent = decodeURIComponent(escape(atob(data.content)));
                        const products = JSON.parse(decodedContent);
                        // Save to localStorage for offline access
                        localStorage.setItem('catalogProducts', JSON.stringify(products));
                        console.log('Produtos carregados do GitHub');
                        showSyncStatus('‚úì Sincronizado com GitHub', 'green');
                        return products;
                    }
                } catch (error) {
                    console.error('Erro ao carregar do GitHub:', error);
                    showSyncStatus('‚ö† Carregando backup local', 'orange');
                }
            }
            
            // Fallback to localStorage
            const savedProducts = localStorage.getItem('catalogProducts');
            if (savedProducts) {
                try {
                    return JSON.parse(savedProducts);
                } catch (e) {
                    console.error('Error loading products from localStorage:', e);
                }
            }
            return [...sampleProducts];
        }

        async function saveProducts() {
            const token = localStorage.getItem('githubToken');
            
            // Always save locally first for immediate response
            localStorage.setItem('catalogProducts', JSON.stringify(allProducts));
            localStorage.setItem('catalogUpdate', Date.now().toString());
            
            if (token) {
                try {
                    // Get current file SHA for GitHub API
                    const sha = await getFileSha('docs/products.json', token);
                    
                    const response = await fetch('https://api.github.com/repos/MoveisBonafe/Catalogo-Moveis-Bonafe/contents/docs/products.json', {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: 'Update products catalog',
                            content: btoa(unescape(encodeURIComponent(JSON.stringify(allProducts, null, 2)))),
                            sha: sha
                        })
                    });

                    if (response.ok) {
                        console.log('‚úì Produtos sincronizados com GitHub');
                        showSyncStatus('‚úì Sincronizado com sucesso', 'green');
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    console.error('Erro na sincroniza√ß√£o GitHub:', error);
                    showSyncStatus('‚ö† Salvando apenas localmente', 'orange');
                }
            } else {
                showSyncStatus('‚ö† Configure o token para sincronizar', 'orange');
            }
        }
        
        async function getFileSha(filePath, token) {
            try {
                const response = await fetch(`https://api.github.com/repos/MoveisBonafe/Catalogo-Moveis-Bonafe/contents/${filePath}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.sha;
                }
            } catch (error) {
                console.error('Error getting file SHA:', error);
            }
            return null;
        }
        
        function showSyncStatus(message, color) {
            const statusElement = document.getElementById('syncStatus') || createSyncStatusElement();
            statusElement.innerHTML = `<span style="color: ${color};">${message}</span>`;
            setTimeout(() => {
                statusElement.innerHTML = '';
            }, 3000);
        }
        
        function createSyncStatusElement() {
            const element = document.createElement('div');
            element.id = 'syncStatus';
            element.style.cssText = 'position: fixed; top: 10px; right: 10px; background: white; padding: 8px 12px; border-radius: 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 1000;';
            document.body.appendChild(element);
            return element;
        }

        let allProducts = [];
        let editingProductId = null;
        
        // Initialize products asynchronously
        async function initializeProducts() {
            allProducts = await loadProducts();
            renderProducts();
        }

        function renderProducts() {
            const container = document.getElementById('productsContainer');
            const loadingState = document.getElementById('loadingState');
            const emptyState = document.getElementById('emptyState');
            const totalProducts = document.getElementById('totalProducts');

            loadingState.style.display = 'none';
            totalProducts.textContent = allProducts.length;
            
            if (allProducts.length === 0) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            container.style.display = 'grid';
            
            container.innerHTML = allProducts.map((product, index) => `
                <div class="product-card draggable-item" draggable="true" data-product-id="${product.id}" data-product-index="${index}">
                    <div class="drag-handle" title="Arrastar para reordenar">‚ãÆ‚ãÆ</div>
                    <div class="product-header">
                        <span class="category-badge">${product.category}</span>
                    </div>
                    <h3 class="product-name">${product.name}</h3>
                    <p class="product-description">${product.description}</p>
                    ${product.features && product.features.length > 0 ? `
                        <div class="features">
                            ${product.features.slice(0, 4).map(feature => 
                                `<span class="feature-tag">${feature}</span>`
                            ).join('')}
                            ${product.features.length > 4 ? 
                                `<span class="feature-tag">+${product.features.length - 4} mais</span>` : ''
                            }
                        </div>
                    ` : ''}
                    ${product.colors && product.colors.length > 0 ? `
                        <div class="colors">
                            <span class="color-label">Cores:</span>
                            <div class="color-dots">
                                ${product.colors.slice(0, 5).map(color => 
                                    `<div class="color-dot" style="background-color: ${color.hex}" title="${color.name}"></div>`
                                ).join('')}
                                ${product.colors.length > 5 ? 
                                    `<span style="font-size: 0.8em; color: #666;">+${product.colors.length - 5}</span>` : ''
                                }
                            </div>
                        </div>
                    ` : ''}
                    <div class="actions">
                        <button class="btn" onclick="editProduct(${product.id})">‚úèÔ∏è Editar</button>
                        <button class="btn btn-danger" onclick="deleteProduct(${product.id})">üóëÔ∏è Excluir</button>
                    </div>
                    <div class="reorder-controls">
                        <button type="button" class="reorder-btn" onclick="moveProductUp(${index})" title="Mover para cima">‚Üë</button>
                        <button type="button" class="reorder-btn" onclick="moveProductDown(${index})" title="Mover para baixo">‚Üì</button>
                    </div>
                </div>
            `).join('');
            
            // Setup drag and drop after rendering
            setupProductDragAndDrop();
        }

        function openAddModal() {
            populateProductForm();
            editingProductId = null;
            document.getElementById('modalTitle').textContent = 'Adicionar Produto';
            document.getElementById('productForm').reset();
            clearColors();
            clearFeatures();
            addFeature(); // Add one feature by default
            displayProductImages([]);
            document.getElementById('productModal').style.display = 'block';
        }

        function editProduct(id) {
            const product = allProducts.find(p => p.id === id);
            if (!product) return;

            populateProductForm();
            editingProductId = id;
            document.getElementById('modalTitle').textContent = 'Editar Produto';
            
            // Fill form with product data
            document.getElementById('productName').value = product.name;
            document.getElementById('productDescription').value = product.description;
            document.getElementById('productCategory').value = product.category;
            
            // Load images
            displayProductImages(product.images || []);

            // Clear and populate colors using new system
            clearColors();
            if (product.colors && product.colors.length > 0) {
                product.colors.forEach(color => {
                    addColorToProduct(color.name, color.hex);
                });
            }

            // Clear and populate features
            clearFeatures();
            if (product.features && product.features.length > 0) {
                product.features.forEach(feature => {
                    addFeature(feature);
                });
            } else {
                addFeature();
            }

            document.getElementById('productModal').style.display = 'block';
        }

        function deleteProduct(id) {
            const product = allProducts.find(p => p.id === id);
            if (!product) return;

            if (confirm(`Tem certeza que deseja excluir "${product.name}"?`)) {
                allProducts = allProducts.filter(p => p.id !== id);
                saveProducts();
                renderProducts();
            }
        }

        function closeModal() {
            document.getElementById('productModal').style.display = 'none';
            editingProductId = null;
        }

        // Add modal click handling
        document.addEventListener('DOMContentLoaded', function() {
            // Product modal
            const productModal = document.getElementById('productModal');
            const productModalContent = productModal.querySelector('.modal-content');
            
            productModal.addEventListener('click', function(e) {
                if (e.target === productModal) {
                    // Don't close when clicking outside - only close with X button
                    e.stopPropagation();
                }
            });
            
            productModalContent.addEventListener('click', function(e) {
                e.stopPropagation();
            });

            // Category modal
            const categoryModal = document.getElementById('categoryModal');
            if (categoryModal) {
                const categoryModalContent = categoryModal.querySelector('.modal-content');
                
                categoryModal.addEventListener('click', function(e) {
                    if (e.target === categoryModal) {
                        e.stopPropagation();
                    }
                });
                
                categoryModalContent.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }

            // Standard color modal
            const standardColorModal = document.getElementById('standardColorModal');
            if (standardColorModal) {
                const standardColorModalContent = standardColorModal.querySelector('.modal-content');
                
                standardColorModal.addEventListener('click', function(e) {
                    if (e.target === standardColorModal) {
                        e.stopPropagation();
                    }
                });
                
                standardColorModalContent.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
        });

        function clearColors() {
            document.getElementById('colorsContainer').innerHTML = '';
        }

        function addFeature(value = '') {
            const container = document.getElementById('featuresContainer');
            
            const featureDiv = document.createElement('div');
            featureDiv.className = 'feature-item';
            featureDiv.innerHTML = `
                <input type="text" class="feature-input" placeholder="Caracter√≠stica do produto" value="${value}">
                <button type="button" class="remove-feature" onclick="removeFeature(this)">‚úñ</button>
            `;
            
            container.appendChild(featureDiv);
        }

        function removeFeature(button) {
            button.parentElement.remove();
        }

        function clearFeatures() {
            document.getElementById('featuresContainer').innerHTML = '';
        }

        function saveGitHubToken() {
            const token = document.getElementById('githubToken').value.trim();
            if (token) {
                localStorage.setItem('githubToken', token);
                document.getElementById('tokenStatus').innerHTML = '<span style="color: green;">‚úì Token salvo com sucesso!</span>';
                setTimeout(() => {
                    document.getElementById('tokenStatus').innerHTML = '';
                }, 3000);
                
                // Immediately check the GitHub token status
                setTimeout(() => {
                    checkGitHubTokenStatus();
                }, 1000);
            } else {
                document.getElementById('tokenStatus').innerHTML = '<span style="color: red;">‚úó Digite um token v√°lido</span>';
            }
        }

        function loadGitHubToken() {
            const savedToken = localStorage.getItem('githubToken');
            if (savedToken) {
                document.getElementById('githubToken').value = savedToken;
                document.getElementById('tokenStatus').innerHTML = '<span style="color: blue;">Token carregado do armazenamento local</span>';
            }
        }

        let currentProductImages = [];

        // Compress image function for PNG files
        async function compressImage(file, quality = 0.8) {
            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = () => {
                    const MAX_WIDTH = 1200;
                    const MAX_HEIGHT = 1200;
                    
                    let { width, height } = img;
                    
                    if (width > height) {
                        if (width > MAX_WIDTH) {
                            height *= MAX_WIDTH / width;
                            width = MAX_WIDTH;
                        }
                    } else {
                        if (height > MAX_HEIGHT) {
                            width *= MAX_HEIGHT / height;
                            height = MAX_HEIGHT;
                        }
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    canvas.toBlob((blob) => {
                        const compressedFile = new File([blob], file.name, {
                            type: 'image/jpeg',
                            lastModified: Date.now()
                        });
                        resolve(compressedFile);
                    }, 'image/jpeg', quality);
                };
                
                img.src = URL.createObjectURL(file);
            });
        }

        function displayProductImagesOriginal(images) {
            currentProductImages = [...images];
            const container = document.getElementById('imagesList');
            
            if (images.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px; grid-column: 1 / -1;">Nenhuma imagem adicionada</p>';
                return;
            }
            
            container.innerHTML = images.map((url, index) => `
                <div style="position: relative; background: white; border-radius: 8px; overflow: hidden; border: 2px solid #E0E0E0;">
                    <img src="${url}" alt="Imagem ${index + 1}" style="width: 100%; height: 120px; object-fit: cover; display: block;">
                    <button onclick="removeProductImageOriginal(${index})" style="position: absolute; top: 5px; right: 5px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; font-size: 14px; cursor: pointer; font-weight: bold;">√ó</button>
                    <div style="padding: 8px; text-align: center; font-size: 12px; color: #666;">Imagem ${index + 1}</div>
                </div>
            `).join('');
        }

        function addFeatureWithValue(featureText) {
            const container = document.getElementById('featuresContainer');
            const featureDiv = document.createElement('div');
            featureDiv.className = 'feature-item';
            featureDiv.innerHTML = `
                <input type="text" class="feature-input" value="${featureText}" placeholder="Digite uma caracter√≠stica">
                <button type="button" class="remove-feature" onclick="removeFeature(this)">Remover</button>
            `;
            container.appendChild(featureDiv);
        }

        function removeProductImage(index) {
            currentProductImages.splice(index, 1);
            displayProductImages(currentProductImages);
        }

        async function uploadImages() {
            const fileInput = document.getElementById('imageUpload');
            const files = fileInput.files;
            const token = localStorage.getItem('githubToken');

            if (!token) {
                document.getElementById('uploadStatus').innerHTML = '<span style="color: red;">‚úó Configure o token GitHub primeiro</span>';
                return;
            }

            if (files.length === 0) {
                document.getElementById('uploadStatus').innerHTML = '<span style="color: red;">‚úó Selecione pelo menos uma imagem</span>';
                return;
            }

            document.getElementById('uploadStatus').innerHTML = '<span style="color: blue;">üì§ Fazendo upload...</span>';

            try {
                for (const file of files) {
                    // Compress PNG images if they are too large
                    let processedFile = file;
                    if (file.type === 'image/png' && file.size > 1024 * 1024) { // > 1MB
                        processedFile = await compressImage(file, 0.8);
                    }
                    
                    // Use FileReader for safe base64 conversion to avoid stack overflow
                    const base64Content = await new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = () => {
                            // Remove data URL prefix to get pure base64
                            const base64 = reader.result.split(',')[1];
                            resolve(base64);
                        };
                        reader.onerror = reject;
                        reader.readAsDataURL(processedFile);
                    });
                    
                    // Clean filename for GitHub compatibility
                    const cleanName = file.name.replace(/[^a-zA-Z0-9.-]/g, '_');
                    const fileName = `images/${Date.now()}-${cleanName}`;
                    
                    const response = await fetch(`https://api.github.com/repos/MoveisBonafe/Catalogo-Moveis-Bonafe/contents/docs/${fileName}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: `Upload high quality image: ${file.name}`,
                            content: base64Content
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        const imageUrl = `https://moveisbonafe.github.io/Catalogo-Moveis-Bonafe/${fileName}`;
                        currentProductImages.push(imageUrl);
                        console.log(`Upload successful: ${imageUrl}`);
                    } else {
                        const errorData = await response.text();
                        console.error(`Upload failed for ${file.name}:`, response.status, errorData);
                        throw new Error(`Erro no upload de ${file.name}: ${response.status} - ${response.statusText}`);
                    }
                }

                displayProductImages(currentProductImages);
                document.getElementById('uploadStatus').innerHTML = '<span style="color: green;">‚úì Imagens enviadas com sucesso!</span>';
                fileInput.value = '';
                
                setTimeout(() => {
                    document.getElementById('uploadStatus').innerHTML = '';
                }, 3000);
            } catch (error) {
                document.getElementById('uploadStatus').innerHTML = `<span style="color: red;">‚úó Erro no upload: ${error.message}</span>`;
            }
        }

        // Removed old fileToBase64 function - now using ArrayBuffer for maximum quality

        function getFormData() {
            // Get colors from the new reorder-item system
            const colors = getCurrentProductColors();

            const features = Array.from(document.querySelectorAll('.feature-input'))
                .map(input => input.value.trim())
                .filter(feature => feature);

            return {
                name: document.getElementById('productName').value.trim(),
                description: document.getElementById('productDescription').value.trim(),
                category: document.getElementById('productCategory').value,
                images: [...currentProductImages],
                colors: colors,
                features: features
            };
        }

        function saveProduct(event) {
            event.preventDefault();
            
            const formData = getFormData();
            
            // Debug: Log the colors being saved
            console.log('Colors being saved:', formData.colors);
            console.log('Total colors found:', formData.colors.length);
            
            // Basic validation
            if (!formData.name || !formData.description || !formData.category) {
                alert('Por favor, preencha todos os campos obrigat√≥rios.');
                return;
            }

            if (editingProductId) {
                // Update existing product
                const index = allProducts.findIndex(p => p.id === editingProductId);
                if (index !== -1) {
                    allProducts[index] = { ...allProducts[index], ...formData };
                    console.log('Updated product:', allProducts[index]);
                }
            } else {
                // Add new product
                const newProduct = {
                    id: Date.now(),
                    ...formData
                };
                allProducts.push(newProduct);
                console.log('Added new product:', newProduct);
            }

            saveProducts();
            renderProducts();
            closeModal();
            
            alert(editingProductId ? 'Produto atualizado com sucesso!' : 'Produto adicionado com sucesso!');
        }

        // Event listeners
        document.getElementById('productForm').addEventListener('submit', saveProduct);

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('productModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Status checking functions
        async function checkConnectionStatus() {
            const connectionStatus = document.getElementById('connectionStatus');
            const connectionIcon = connectionStatus.querySelector('.status-icon');
            const connectionText = connectionStatus.querySelector('span');
            
            try {
                // Test connection with a simple fetch to GitHub API
                const response = await fetch('https://api.github.com/rate_limit', {
                    method: 'GET',
                    cache: 'no-cache'
                });
                
                if (response.ok) {
                    connectionStatus.className = 'status-indicator status-online';
                    connectionIcon.className = 'status-icon online';
                    connectionText.textContent = 'Online';
                } else {
                    throw new Error('Connection failed');
                }
            } catch (error) {
                connectionStatus.className = 'status-indicator status-offline';
                connectionIcon.className = 'status-icon offline';
                connectionText.textContent = 'Offline';
            }
        }

        async function checkGitHubTokenStatus() {
            const githubStatus = document.getElementById('githubStatus');
            const githubIcon = githubStatus.querySelector('.status-icon');
            const githubText = githubStatus.querySelector('span');
            const githubWarning = document.getElementById('githubWarning');
            
            const token = localStorage.getItem('githubToken');
            
            if (!token) {
                githubStatus.className = 'status-indicator status-warning';
                githubIcon.className = 'status-icon warning';
                githubText.textContent = 'Token n√£o configurado';
                githubWarning.style.display = 'block';
                return;
            }
            
            try {
                // Validate token by making a test request
                const response = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    githubStatus.className = 'status-indicator status-online';
                    githubIcon.className = 'status-icon online';
                    githubText.textContent = 'Token v√°lido';
                    githubWarning.style.display = 'none';
                } else {
                    throw new Error('Invalid token');
                }
            } catch (error) {
                githubStatus.className = 'status-indicator status-warning';
                githubIcon.className = 'status-icon warning';
                githubText.textContent = 'Token inv√°lido';
                githubWarning.style.display = 'block';
            }
        }

        function startStatusMonitoring() {
            // Initial check
            checkConnectionStatus();
            checkGitHubTokenStatus();
            
            // Check connection every 30 seconds
            setInterval(checkConnectionStatus, 30000);
            
            // Check GitHub token every 2 minutes
            setInterval(checkGitHubTokenStatus, 120000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadGitHubToken();
            displayProductImages([]);
            initializeProducts();
            startStatusMonitoring();
        });
        
        setTimeout(() => {
            renderProducts();
        }, 1000);
    </script>

    <!-- Modal para gerenciar categoria -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="categoryModalTitle">Nova Categoria</h2>
                <span class="close" onclick="closeCategoryModal()">&times;</span>
            </div>
            <form id="categoryForm">
                <div class="form-group">
                    <label class="form-label">Nome da Categoria:</label>
                    <input type="text" id="categoryName" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Slug (URL amig√°vel):</label>
                    <input type="text" id="categorySlug" class="form-input" required>
                    <small style="color: #666;">Ex: moveis-sala, decoracao, etc.</small>
                </div>
                <div class="form-group">
                    <label class="form-label">Nome de Exibi√ß√£o:</label>
                    <input type="text" id="categoryDisplayName" class="form-input" required>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn">Salvar Categoria</button>
                    <button type="button" class="btn btn-secondary" onclick="closeCategoryModal()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para cor padr√£o -->
    <div id="standardColorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="standardColorModalTitle">Nova Cor Padr√£o</h2>
                <span class="close" onclick="closeStandardColorModal()">&times;</span>
            </div>
            <form id="standardColorForm">
                <div class="form-group">
                    <label class="form-label">Nome da Cor:</label>
                    <input type="text" id="standardColorName" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">C√≥digo da Cor:</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="color" id="standardColorHex" class="form-input" style="width: 60px; height: 40px;" required>
                        <input type="text" id="standardColorHexText" class="form-input" placeholder="#FFFFFF" required>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn">Salvar Cor</button>
                    <button type="button" class="btn btn-secondary" onclick="closeStandardColorModal()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global variables for management
        let allCategories = [];
        let allStandardColors = [];
        let editingCategoryId = null;
        let editingStandardColorId = null;

        // Category Management Functions
        function openCategoryModal(categoryId = null) {
            editingCategoryId = categoryId;
            const modal = document.getElementById('categoryModal');
            const title = document.getElementById('categoryModalTitle');
            const form = document.getElementById('categoryForm');
            
            if (categoryId) {
                const category = allCategories.find(c => c.id === categoryId);
                if (category) {
                    title.textContent = 'Editar Categoria';
                    document.getElementById('categoryName').value = category.name;
                    document.getElementById('categorySlug').value = category.slug;
                    document.getElementById('categoryDisplayName').value = category.displayName;
                }
            } else {
                title.textContent = 'Nova Categoria';
                form.reset();
            }
            
            modal.style.display = 'block';
        }

        function closeCategoryModal() {
            document.getElementById('categoryModal').style.display = 'none';
            editingCategoryId = null;
        }

        function toggleCategoryList() {
            const list = document.getElementById('categoryList');
            list.style.display = list.style.display === 'none' ? 'block' : 'none';
            if (list.style.display === 'block') {
                renderCategories();
            }
        }

        function renderCategories() {
            const container = document.getElementById('categoryContainer');
            
            if (allCategories.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center;">Nenhuma categoria personalizada criada</p>';
                return;
            }
            
            container.innerHTML = allCategories.map(category => `
                <div class="category-item">
                    <div>
                        <div class="category-name">${category.displayName || category.name}</div>
                        <small style="color: #666;">${category.slug}</small>
                    </div>
                    <div class="category-actions-inline">
                        <button class="btn btn-small" onclick="openCategoryModal('${category.id}')">‚úèÔ∏è Editar</button>
                        <button class="btn btn-small btn-danger" onclick="deleteCategory('${category.id}')">üóëÔ∏è Excluir</button>
                    </div>
                </div>
            `).join('');
        }

        function deleteCategory(categoryId) {
            if (confirm('Tem certeza que deseja excluir esta categoria?')) {
                allCategories = allCategories.filter(c => c.id !== categoryId);
                saveCategories();
                renderCategories();
                updateStats();
            }
        }

        // Standard Color Management Functions
        function openStandardColorModal(colorId = null) {
            editingStandardColorId = colorId;
            const modal = document.getElementById('standardColorModal');
            const title = document.getElementById('standardColorModalTitle');
            const form = document.getElementById('standardColorForm');
            
            if (colorId) {
                const color = allStandardColors.find(c => c.id === colorId);
                if (color) {
                    title.textContent = 'Editar Cor Padr√£o';
                    document.getElementById('standardColorName').value = color.name;
                    document.getElementById('standardColorHex').value = color.hex;
                    document.getElementById('standardColorHexText').value = color.hex;
                }
            } else {
                title.textContent = 'Nova Cor Padr√£o';
                form.reset();
            }
            
            modal.style.display = 'block';
        }

        function closeStandardColorModal() {
            document.getElementById('standardColorModal').style.display = 'none';
            editingStandardColorId = null;
        }

        function toggleStandardColorList() {
            const list = document.getElementById('standardColorList');
            list.style.display = list.style.display === 'none' ? 'block' : 'none';
            if (list.style.display === 'block') {
                renderStandardColors();
            }
        }

        function renderStandardColors() {
            const container = document.getElementById('standardColorContainer');
            
            if (allStandardColors.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center;">Nenhuma cor padr√£o criada</p>';
                return;
            }
            
            container.innerHTML = allStandardColors.map(color => `
                <div class="standard-color-item">
                    <div class="standard-color-preview">
                        <div class="color-dot-large" style="background-color: ${color.hex}"></div>
                        <div>
                            <div style="font-weight: 500;">${color.name}</div>
                            <small style="color: #666;">${color.hex}</small>
                        </div>
                    </div>
                    <div class="category-actions-inline">
                        <button class="btn btn-small" onclick="openStandardColorModal('${color.id}')">‚úèÔ∏è Editar</button>
                        <button class="btn btn-small btn-danger" onclick="deleteStandardColor('${color.id}')">üóëÔ∏è Excluir</button>
                    </div>
                </div>
            `).join('');
        }

        function deleteStandardColor(colorId) {
            if (confirm('Tem certeza que deseja excluir esta cor padr√£o?')) {
                allStandardColors = allStandardColors.filter(c => c.id !== colorId);
                saveStandardColors();
                renderStandardColors();
                updateStats();
            }
        }

        // Form submissions
        document.getElementById('categoryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('categoryName').value.trim();
            const slug = document.getElementById('categorySlug').value.trim();
            const displayName = document.getElementById('categoryDisplayName').value.trim();
            
            if (!name || !slug || !displayName) return;
            
            const categoryData = {
                id: editingCategoryId || Date.now().toString(),
                name,
                slug,
                displayName
            };
            
            if (editingCategoryId) {
                const index = allCategories.findIndex(c => c.id === editingCategoryId);
                if (index >= 0) {
                    allCategories[index] = categoryData;
                }
            } else {
                allCategories.push(categoryData);
            }
            
            saveCategories();
            renderCategories();
            updateStats();
            closeCategoryModal();
        });

        document.getElementById('standardColorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('standardColorName').value.trim();
            const hex = document.getElementById('standardColorHex').value;
            
            if (!name || !hex) return;
            
            const colorData = {
                id: editingStandardColorId || Date.now().toString(),
                name,
                hex
            };
            
            if (editingStandardColorId) {
                const index = allStandardColors.findIndex(c => c.id === editingStandardColorId);
                if (index >= 0) {
                    allStandardColors[index] = colorData;
                }
            } else {
                allStandardColors.push(colorData);
            }
            
            saveStandardColors();
            renderStandardColors();
            updateStats();
            closeStandardColorModal();
        });

        // Sync color picker and text input
        document.getElementById('standardColorHex').addEventListener('input', function() {
            document.getElementById('standardColorHexText').value = this.value;
        });

        document.getElementById('standardColorHexText').addEventListener('input', function() {
            document.getElementById('standardColorHex').value = this.value;
        });

        // Auto-generate slug from name
        document.getElementById('categoryName').addEventListener('input', function() {
            const slug = this.value.toLowerCase()
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .trim();
            document.getElementById('categorySlug').value = slug;
        });

        // Storage functions
        function saveCategories() {
            localStorage.setItem('catalogCategories', JSON.stringify(allCategories));
        }

        function loadCategories() {
            const saved = localStorage.getItem('catalogCategories');
            if (saved) {
                try {
                    allCategories = JSON.parse(saved);
                } catch (e) {
                    console.error('Error loading categories:', e);
                    allCategories = [];
                }
            }
        }

        function saveStandardColors() {
            localStorage.setItem('catalogStandardColors', JSON.stringify(allStandardColors));
        }

        function loadStandardColors() {
            const saved = localStorage.getItem('catalogStandardColors');
            if (saved) {
                try {
                    allStandardColors = JSON.parse(saved);
                } catch (e) {
                    console.error('Error loading standard colors:', e);
                    allStandardColors = [];
                }
            }
        }

        function updateStats() {
            document.getElementById('totalProducts').textContent = allProducts.length;
            document.getElementById('totalCategories').textContent = allCategories.length;
            document.getElementById('totalStandardColors').textContent = allStandardColors.length;
        }

        // Enhanced Product Form Functions
        function populateProductForm() {
            populateCategorySelect();
            populateStandardColorSelect();
        }

        function populateCategorySelect() {
            const select = document.getElementById('productCategory');
            const defaultOptions = [
                { name: 'Sof√°s', slug: 'sofas', displayName: 'Sof√°s' },
                { name: 'Poltronas', slug: 'poltronas', displayName: 'Poltronas' },
                { name: 'Mesas', slug: 'mesas', displayName: 'Mesas' },
                { name: 'Cadeiras', slug: 'cadeiras', displayName: 'Cadeiras' },
                { name: 'Estantes', slug: 'estantes', displayName: 'Estantes' },
                { name: 'Camas', slug: 'camas', displayName: 'Camas' },
                { name: 'Guarda-roupas', slug: 'guarda-roupas', displayName: 'Guarda-roupas' },
                { name: 'Decora√ß√£o', slug: 'decoracao', displayName: 'Decora√ß√£o' }
            ];
            
            // Clear existing options except first
            select.innerHTML = '<option value="">Selecione uma categoria</option>';
            
            // Add default categories
            defaultOptions.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.name;
                option.textContent = cat.displayName;
                select.appendChild(option);
            });
            
            // Add custom categories
            allCategories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.name;
                option.textContent = cat.displayName;
                select.appendChild(option);
            });
        }

        function populateStandardColorSelect() {
            const select = document.getElementById('standardColorSelect');
            select.innerHTML = '<option value="">Selecione uma cor padr√£o para adicionar</option>';
            
            allStandardColors.forEach(color => {
                const option = document.createElement('option');
                option.value = color.id;
                option.textContent = `${color.name} (${color.hex})`;
                select.appendChild(option);
            });
        }

        function addStandardColor() {
            const select = document.getElementById('standardColorSelect');
            const colorId = select.value;
            
            if (!colorId) return;
            
            const standardColor = allStandardColors.find(c => c.id === colorId);
            if (!standardColor) return;
            
            // Check if color already exists
            const existingColors = getCurrentProductColors();
            if (existingColors.some(c => c.hex === standardColor.hex)) {
                alert('Esta cor j√° foi adicionada ao produto');
                return;
            }
            
            addColorToProduct(standardColor.name, standardColor.hex);
            select.value = '';
        }

        function addCustomColor() {
            const name = prompt('Nome da cor:');
            if (!name) return;
            
            const hex = prompt('C√≥digo da cor (ex: #FF0000):');
            if (!hex || !hex.match(/^#[0-9A-Fa-f]{6}$/)) {
                alert('C√≥digo de cor inv√°lido. Use o formato #RRGGBB');
                return;
            }
            
            addColorToProduct(name, hex);
        }

        function addColorToProduct(name, hex) {
            const container = document.getElementById('colorsContainer');
            const colorId = Date.now().toString();
            
            const colorDiv = document.createElement('div');
            colorDiv.className = 'reorder-item';
            colorDiv.draggable = true;
            colorDiv.dataset.colorId = colorId;
            colorDiv.innerHTML = `
                <div class="color-dot-large" style="background-color: ${hex}; margin-bottom: 5px;"></div>
                <div style="font-size: 0.8em; font-weight: 500;">${name}</div>
                <div style="font-size: 0.7em; color: #666;">${hex}</div>
                <div class="reorder-controls">
                    <button type="button" class="reorder-btn" onclick="moveColorUp(this)" title="Mover para cima">‚Üë</button>
                    <button type="button" class="reorder-btn" onclick="moveColorDown(this)" title="Mover para baixo">‚Üì</button>
                    <button type="button" class="reorder-btn" onclick="removeColor(this)" title="Remover">√ó</button>
                </div>
            `;
            
            setupColorDragAndDrop(colorDiv);
            container.appendChild(colorDiv);
        }

        function getCurrentProductColors() {
            const container = document.getElementById('colorsContainer');
            const colorElements = container.querySelectorAll('.reorder-item');
            
            console.log('Color container found:', container);
            console.log('Color elements found:', colorElements.length);
            
            return Array.from(colorElements).map(el => {
                const name = el.querySelector('div:nth-child(2)').textContent;
                const hex = el.querySelector('div:nth-child(3)').textContent;
                console.log('Extracting color:', { name, hex });
                return { name, hex };
            });
        }

        function setupColorDragAndDrop(element) {
            element.addEventListener('dragstart', function(e) {
                this.classList.add('dragging');
                e.dataTransfer.setData('text/plain', this.dataset.colorId);
            });
            
            element.addEventListener('dragend', function() {
                this.classList.remove('dragging');
            });
            
            element.addEventListener('dragover', function(e) {
                e.preventDefault();
            });
            
            element.addEventListener('drop', function(e) {
                e.preventDefault();
                const draggedId = e.dataTransfer.getData('text/plain');
                const draggedElement = document.querySelector(`[data-color-id="${draggedId}"]`);
                
                if (draggedElement && draggedElement !== this) {
                    const container = this.parentElement;
                    const afterElement = getDragAfterElement(container, e.clientY);
                    
                    if (afterElement == null) {
                        container.appendChild(draggedElement);
                    } else {
                        container.insertBefore(draggedElement, afterElement);
                    }
                }
            });
        }

        function setupImageDragAndDrop() {
            const container = document.getElementById('imagesList');
            
            container.addEventListener('dragover', function(e) {
                e.preventDefault();
            });
            
            container.addEventListener('drop', function(e) {
                e.preventDefault();
                // Handle image reordering
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.reorder-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function moveColorUp(button) {
            const colorItem = button.closest('.reorder-item');
            const prevItem = colorItem.previousElementSibling;
            
            if (prevItem) {
                colorItem.parentElement.insertBefore(colorItem, prevItem);
            }
        }

        function moveColorDown(button) {
            const colorItem = button.closest('.reorder-item');
            const nextItem = colorItem.nextElementSibling;
            
            if (nextItem) {
                colorItem.parentElement.insertBefore(nextItem, colorItem);
            }
        }

        function removeColor(button) {
            if (confirm('Remover esta cor do produto?')) {
                button.closest('.reorder-item').remove();
            }
        }

        function moveImageUp(button) {
            const imageItem = button.closest('.reorder-item');
            const prevItem = imageItem.previousElementSibling;
            
            if (prevItem) {
                // Update currentProductImages array
                const container = imageItem.parentElement;
                const items = Array.from(container.children);
                const currentIndex = items.indexOf(imageItem);
                
                if (currentIndex > 0) {
                    // Swap in array
                    [currentProductImages[currentIndex], currentProductImages[currentIndex - 1]] = 
                    [currentProductImages[currentIndex - 1], currentProductImages[currentIndex]];
                    
                    // Move in DOM
                    container.insertBefore(imageItem, prevItem);
                }
            }
        }

        function moveImageDown(button) {
            const imageItem = button.closest('.reorder-item');
            const nextItem = imageItem.nextElementSibling;
            
            if (nextItem) {
                // Update currentProductImages array
                const container = imageItem.parentElement;
                const items = Array.from(container.children);
                const currentIndex = items.indexOf(imageItem);
                
                if (currentIndex < items.length - 1) {
                    // Swap in array
                    [currentProductImages[currentIndex], currentProductImages[currentIndex + 1]] = 
                    [currentProductImages[currentIndex + 1], currentProductImages[currentIndex]];
                    
                    // Move in DOM
                    container.insertBefore(nextItem, imageItem);
                }
            }
        }

        function removeProductImage(index) {
            currentProductImages.splice(index, 1);
            displayProductImages(currentProductImages);
        }

        // Override displayProductImages to include reorder controls
        function displayProductImages(images) {
            currentProductImages = [...images];
            const container = document.getElementById('imagesList');
            
            if (images.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px; grid-column: 1 / -1;">Nenhuma imagem adicionada</p>';
                return;
            }
            
            container.innerHTML = images.map((url, index) => `
                <div class="reorder-item" draggable="true">
                    <img src="${url}" alt="Imagem ${index + 1}" style="width: 100%; height: 80px; object-fit: cover; border-radius: 4px;">
                    <div style="padding: 5px; text-align: center; font-size: 11px; color: #666;">Imagem ${index + 1}</div>
                    <div class="reorder-controls">
                        <button type="button" class="reorder-btn" onclick="moveImageUp(this)" title="Mover para cima">‚Üë</button>
                        <button type="button" class="reorder-btn" onclick="moveImageDown(this)" title="Mover para baixo">‚Üì</button>
                        <button type="button" class="reorder-btn" onclick="removeProductImage(${index})" title="Remover">√ó</button>
                    </div>
                </div>
            `).join('');
        }

        // Initialize management data
        function initializeManagement() {
            loadCategories();
            loadStandardColors();
            updateStats();
        }

        // Enhanced openAddModal function
        function openAddModal(productId = null) {
            populateProductForm();
            
            // Rest of existing openAddModal logic...
            editingProductId = productId;
            const modal = document.getElementById('productModal');
            const title = document.getElementById('modalTitle');
            const form = document.getElementById('productForm');
            
            if (productId) {
                const product = allProducts.find(p => p.id === productId);
                if (product) {
                    title.textContent = 'Editar Produto';
                    document.getElementById('productName').value = product.name;
                    document.getElementById('productDescription').value = product.description;
                    document.getElementById('productCategory').value = product.category;
                    
                    // Load existing colors
                    document.getElementById('colorsContainer').innerHTML = '';
                    if (product.colors) {
                        product.colors.forEach(color => {
                            addColorToProduct(color.name, color.hex);
                        });
                    }
                    
                    // Load existing features
                    clearFeatures();
                    if (product.features) {
                        product.features.forEach(feature => {
                            addFeatureWithValue(feature);
                        });
                    }
                    
                    displayProductImages(product.images || []);
                }
            } else {
                title.textContent = 'Adicionar Produto';
                form.reset();
                document.getElementById('colorsContainer').innerHTML = '';
                clearFeatures();
                displayProductImages([]);
            }
            
            modal.style.display = 'block';
        }

        // Product reordering functions
        function setupProductDragAndDrop() {
            const container = document.getElementById('productsContainer');
            const draggableItems = container.querySelectorAll('.draggable-item');
            
            draggableItems.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('drop', handleDrop);
            });
        }

        function handleDragStart(e) {
            this.classList.add('dragging');
            e.dataTransfer.setData('text/plain', this.dataset.productId);
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDrop(e) {
            e.preventDefault();
            const draggedId = e.dataTransfer.getData('text/plain');
            const draggedElement = document.querySelector(`[data-product-id="${draggedId}"]`);
            const dropTarget = e.currentTarget;
            
            if (draggedElement && draggedElement !== dropTarget) {
                const container = document.getElementById('productsContainer');
                const afterElement = getDragAfterElement(container, e.clientY);
                
                // Update the products array order
                const draggedIndex = parseInt(draggedElement.dataset.productIndex);
                const dropIndex = parseInt(dropTarget.dataset.productIndex);
                
                // Move item in array
                const movedProduct = allProducts.splice(draggedIndex, 1)[0];
                allProducts.splice(dropIndex, 0, movedProduct);
                
                // Save and re-render
                saveProducts();
                renderProducts();
            }
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.draggable-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function moveProductUp(index) {
            if (index > 0) {
                // Swap products in array
                [allProducts[index], allProducts[index - 1]] = [allProducts[index - 1], allProducts[index]];
                saveProducts();
                renderProducts();
            }
        }

        function moveProductDown(index) {
            if (index < allProducts.length - 1) {
                // Swap products in array
                [allProducts[index], allProducts[index + 1]] = [allProducts[index + 1], allProducts[index]];
                saveProducts();
                renderProducts();
            }
        }

        // Add to existing initialization
        const originalInit = document.addEventListener('DOMContentLoaded', function() {
            loadGitHubToken();
            displayProductImages([]);
            initializeProducts();
            startStatusMonitoring();
            initializeManagement();
        });
    </script>
</body>
</html>