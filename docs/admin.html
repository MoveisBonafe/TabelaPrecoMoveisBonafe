<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <meta name="description" content="MoveisBonafe - Painel administrativo completo.">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.5;
        }
        
        .header {
            background: #fff;
            border-bottom: 1px solid #e0e0e0;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .admin-badge {
            background: #4a90e2;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .admin-label {
            background: #ff4757;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .logout-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        
        .logout-btn:hover {
            background: #ff3742;
        }
        
        .nav-tabs {
            background: #fff;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            padding: 0 20px;
            overflow-x: auto;
        }
        
        .nav-tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            color: #666;
            font-weight: 500;
            font-size: 14px;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .nav-tab:hover {
            color: #4a90e2;
            background: #f8f9fa;
        }
        
        .nav-tab.active {
            color: #4a90e2;
            border-bottom-color: #4a90e2;
            background: #f8f9fa;
        }
        
        .tab-icon {
            font-size: 16px;
        }
        
        .content {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .tab-content {
            display: none;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .tab-content.active {
            display: block;
        }
        
        .content-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .content-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        
        .action-buttons {
            display: flex;
            gap: 12px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .btn-primary {
            background: #4a90e2;
            color: white;
        }
        
        .btn-primary:hover {
            background: #357abd;
        }
        
        .btn-success {
            background: #5cb85c;
            color: white;
        }
        
        .btn-success:hover {
            background: #449d44;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        .data-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #555;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            vertical-align: middle;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        .product-image-cell {
            width: 60px;
            height: 60px;
            background: #f5f5f5;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 24px;
        }
        
        .action-buttons-cell {
            display: flex;
            gap: 8px;
        }
        
        .btn-sm {
            padding: 4px 8px;
            font-size: 12px;
        }
        
        .btn-edit {
            background: #f39c12;
            color: white;
        }
        
        .btn-edit:hover {
            background: #e67e22;
        }
        
        .btn-delete {
            background: #e74c3c;
            color: white;
        }
        
        .btn-delete:hover {
            background: #c0392b;
        }
        
        .price-cell {
            font-weight: 600;
            color: #27ae60;
        }
        
        .empty-state {
            padding: 60px 20px;
            text-align: center;
            color: #999;
        }
        
        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #666;
        }
        
        .loading {
            padding: 60px 20px;
            text-align: center;
            color: #999;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 8px;
            padding: 24px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover {
            color: #666;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #555;
        }
        
        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
        }
        
        .form-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: white;
        }
        
        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid #e0e0e0;
        }
        
        .btn-cancel {
            background: #6c757d;
            color: white;
        }
        
        .btn-cancel:hover {
            background: #545b62;
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }
            
            .nav-tabs {
                padding: 0 10px;
            }
            
            .nav-tab {
                padding: 8px 12px;
                font-size: 13px;
            }
            
            .content {
                padding: 12px;
            }
            
            .content-header {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }
            
            .data-table {
                font-size: 12px;
            }
            
            .data-table th,
            .data-table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <span class="admin-badge">üìã Admin Panel</span>
            <span class="admin-label">Administrador</span>
        </div>
        <div class="header-right">
            <button id="github-token-btn" class="btn" onclick="configureGitHubToken()" style="margin-right: 15px; padding: 8px 16px; font-size: 14px; font-weight: bold; background: #ffc107; color: #212529; border: 2px solid #fff; border-radius: 6px;">
                üîë Configurar GitHub Token
            </button>
            <button class="logout-btn" onclick="logout()">Sair</button>
        </div>
    </div>

    <div class="nav-tabs">
        <div class="nav-tab active" onclick="showTab('produtos')" data-tab="produtos">
            <span class="tab-icon">üì¶</span>
            <span>Produtos</span>
        </div>
        <div class="nav-tab" onclick="showTab('categorias')" data-tab="categorias">
            <span class="tab-icon">üè∑Ô∏è</span>
            <span>Categorias</span>
        </div>
        <div class="nav-tab" onclick="showTab('precos')" data-tab="precos">
            <span class="tab-icon">üí∞</span>
            <span>Pre√ßos</span>
        </div>
        <div class="nav-tab" onclick="showTab('usuarios')" data-tab="usuarios">
            <span class="tab-icon">üë•</span>
            <span>Usu√°rios</span>
        </div>
        <div class="nav-tab" onclick="showTab('promocoes')" data-tab="promocoes">
            <span class="tab-icon">üéØ</span>
            <span>Promo√ß√µes</span>
        </div>
        <div class="nav-tab" onclick="showTab('excel')" data-tab="excel">
            <span class="tab-icon">üìä</span>
            <span>Excel</span>
        </div>
        <div class="nav-tab" onclick="showTab('backup')" data-tab="backup">
            <span class="tab-icon">üíæ</span>
            <span>Backup</span>
        </div>
        <div class="nav-tab" onclick="showTab('monitor')" data-tab="monitor">
            <span class="tab-icon">üìà</span>
            <span>Monitor</span>
        </div>
    </div>

    <div class="content">
        <!-- Produtos Tab -->
        <div id="produtos-tab" class="tab-content active">
            <div class="content-header">
                <h2 class="content-title">Gerenciar Produtos</h2>
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="importExcel()">
                        üìä Importar Excel
                    </button>
                    <button class="btn btn-primary" onclick="openProductModal()">
                        ‚ûï Novo Produto
                    </button>
                </div>
            </div>
            <div id="produtos-loading" class="loading">Carregando produtos...</div>
            <div id="produtos-content" style="display: none;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Imagem</th>
                            <th>Produto</th>
                            <th>√Ä Vista</th>
                            <th>30</th>
                            <th>30/60</th>
                            <th>30/60/90</th>
                            <th>30/60/90/120</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="produtos-table">
                    </tbody>
                </table>
                <div id="produtos-empty" class="empty-state" style="display: none;">
                    <h3>Nenhum produto cadastrado</h3>
                    <p>Comece adicionando seu primeiro produto</p>
                </div>
            </div>
        </div>

        <!-- Categorias Tab -->
        <div id="categorias-tab" class="tab-content">
            <div class="content-header">
                <h2 class="content-title">Gerenciar Categorias</h2>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="openCategoryModal()">
                        ‚ûï Nova Categoria
                    </button>
                </div>
            </div>
            <div id="categorias-loading" class="loading">Carregando categorias...</div>
            <div id="categorias-content" style="display: none;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Descri√ß√£o</th>
                            <th>Cor</th>
                            <th>Produtos</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="categorias-table">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Pre√ßos Tab -->
        <div id="precos-tab" class="tab-content">
            <div class="content-header">
                <h2 class="content-title">Gerenciar Tabelas de Pre√ßos</h2>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="openPriceModal()">
                        ‚ûï Nova Tabela
                    </button>
                </div>
            </div>
            <div id="precos-loading" class="loading">Carregando tabelas de pre√ßos...</div>
            <div id="precos-content" style="display: none;">
                <h3 style="margin-bottom: 16px; color: #333; font-size: 16px;">Tabelas de Pre√ßos Configuradas</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Nome da Tabela</th>
                            <th>Percentual (%)</th>
                            <th>Multiplicador</th>
                            <th>Exemplo (R$ 100)</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="precos-table">
                    </tbody>
                </table>
            </div>
        </div>

        <div id="usuarios-tab" class="tab-content">
            <div class="content-header">
                <h2 class="content-title">Gerenciar Usu√°rios</h2>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="openUserModal()">
                        ‚ûï Novo Usu√°rio
                    </button>
                </div>
            </div>
            <div id="usuarios-loading" class="loading">Carregando usu√°rios...</div>
            <div id="usuarios-content" style="display: none;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Username</th>
                            <th>Fun√ß√£o</th>
                            <th>Multiplicador</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="usuarios-table">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Promo√ß√µes Tab -->
        <div id="promocoes-tab" class="tab-content">
            <div class="content-header">
                <h2 class="content-title">üéØ Gerenciar Promo√ß√µes</h2>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="openPromotionModal()">
                        ‚ûï Nova Promo√ß√£o
                    </button>
                </div>
            </div>
            <div id="promocoes-loading" class="loading">Carregando promo√ß√µes...</div>
            <div id="promocoes-content" style="display: none;">
                <div class="promotion-info" style="background: #e3f2fd; border: 1px solid #2196f3; border-radius: 6px; padding: 16px; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <span style="font-size: 16px;">üí°</span>
                        <strong style="color: #1976d2;">Dica:</strong>
                    </div>
                    <p style="color: #1976d2; font-size: 14px; margin: 0;">
                        Apenas uma promo√ß√£o pode estar ativa por vez. Ao ativar uma nova promo√ß√£o, as outras ser√£o automaticamente desativadas.
                    </p>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Texto</th>
                            <th>Descri√ß√£o</th>
                            <th>Cor</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="promocoes-table">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Excel Tab -->
        <div id="excel-tab" class="tab-content">
            <div class="content-header">
                <h2 class="content-title">Importar/Exportar Excel</h2>
            </div>
            <div style="padding: 24px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 32px; margin-bottom: 32px;">
                    <!-- Import Section -->
                    <div style="background: #f8f9fa; border-radius: 8px; padding: 24px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                            <span style="font-size: 20px;">üì•</span>
                            <h3 style="margin: 0; color: #333;">Importar Produtos</h3>
                        </div>
                        <p style="color: #666; margin-bottom: 16px; font-size: 14px;">
                            Importe produtos em massa usando arquivo Excel (.xlsx/.csv)
                        </p>
                        <input type="file" id="excel-upload" accept=".xlsx,.csv" style="display: none;" onchange="handleExcelUpload(event)">
                        <button class="btn btn-success" onclick="document.getElementById('excel-upload').click()">
                            Selecionar Arquivo
                        </button>
                    </div>
                    
                    <!-- Export Section -->
                    <div style="background: #f8f9fa; border-radius: 8px; padding: 24px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                            <span style="font-size: 20px;">üì§</span>
                            <h3 style="margin: 0; color: #333;">Exportar Produtos</h3>
                        </div>
                        <p style="color: #666; margin-bottom: 16px; font-size: 14px;">
                            Exporte todos os produtos para arquivo CSV
                        </p>
                        <button class="btn btn-primary" onclick="exportToCSV()">
                            Baixar CSV
                        </button>
                    </div>
                </div>
                
                <!-- Format Guide -->
                <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px;">
                    <h3 style="margin: 0 0 16px 0; color: #333;">Formato de Importa√ß√£o</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Categoria</th>
                                <th>Pre√ßo</th>
                                <th>Altura</th>
                                <th>Largura</th>
                                <th>Comprimento</th>
                                <th>Peso</th>
                                <th>Descri√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Sof√° 3 Lugares</td>
                                <td>Sala de Estar</td>
                                <td>1200.00</td>
                                <td>85</td>
                                <td>200</td>
                                <td>90</td>
                                <td>45.5</td>
                                <td>Sof√° confort√°vel para sala</td>
                            </tr>
                        </tbody>
                    </table>
                    <p style="color: #666; font-size: 13px; margin: 12px 0 0 0;">
                        <strong>Importante:</strong> Use separa√ß√£o por TAB (colunas) para melhor compatibilidade com Excel. Evite acentos nos cabe√ßalhos.
                    </p>
                </div>
            </div>
        </div>

        <!-- Backup Tab -->
        <div id="backup-tab" class="tab-content">
            <div class="content-header">
                <h2 class="content-title">üíæ Backup do Sistema</h2>
            </div>
            <div style="padding: 24px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 32px;">
                    <!-- Backup Section -->
                    <div style="background: #f8f9fa; border-radius: 8px; padding: 24px;">
                        <h3 style="margin: 0 0 16px 0; color: #333;">Fazer Backup</h3>
                        <p style="color: #666; margin-bottom: 16px; font-size: 14px;">
                            Baixe todos os dados do sistema em formato JSON
                        </p>
                        <button class="btn btn-primary" onclick="downloadBackup()">
                            üì• Baixar Backup Completo
                        </button>
                    </div>
                    
                    <!-- Restore Section -->
                    <div style="background: #f8f9fa; border-radius: 8px; padding: 24px;">
                        <h3 style="margin: 0 0 16px 0; color: #333;">Restaurar Backup</h3>
                        <p style="color: #666; margin-bottom: 16px; font-size: 14px;">
                            Restaure dados de um arquivo de backup JSON
                        </p>
                        <input type="file" id="backup-upload" accept=".json" style="display: none;" onchange="handleBackupRestore(event)">
                        <button class="btn btn-success" onclick="document.getElementById('backup-upload').click()">
                            üì§ Selecionar Backup
                        </button>
                    </div>
                </div>
                
                <!-- Backup Info -->
                <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-top: 24px;">
                    <h3 style="margin: 0 0 16px 0; color: #333;">Informa√ß√µes do Sistema</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        <div>
                            <strong>√öltima Atualiza√ß√£o:</strong><br>
                            <span id="last-backup-date">-</span>
                        </div>
                        <div>
                            <strong>Total de Registros:</strong><br>
                            <span id="total-records">-</span>
                        </div>
                        <div>
                            <strong>Tamanho dos Dados:</strong><br>
                            <span id="data-size">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Monitor Tab -->
        <div id="monitor-tab" class="tab-content">
            <div class="content-header">
                <h2 class="content-title">üìà Monitor do Sistema</h2>
            </div>
            <div style="padding: 24px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 24px;">
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; text-align: center;">
                        <h3 style="margin: 0 0 8px 0; color: #4a90e2; font-size: 2rem;" id="monitor-products">-</h3>
                        <p style="margin: 0; color: #666;">Produtos Ativos</p>
                    </div>
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; text-align: center;">
                        <h3 style="margin: 0 0 8px 0; color: #5cb85c; font-size: 2rem;" id="monitor-categories">-</h3>
                        <p style="margin: 0; color: #666;">Categorias</p>
                    </div>
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; text-align: center;">
                        <h3 style="margin: 0 0 8px 0; color: #f39c12; font-size: 2rem;" id="monitor-users">-</h3>
                        <p style="margin: 0; color: #666;">Usu√°rios Ativos</p>
                    </div>
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; text-align: center;">
                        <h3 style="margin: 0 0 8px 0; color: #e74c3c; font-size: 2rem;" id="monitor-promotions">-</h3>
                        <p style="margin: 0; color: #666;">Promo√ß√µes Ativas</p>
                    </div>
                </div>
                
                <!-- GitHub Configuration -->
                <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 16px;">
                        <span id="github-status-online" style="display: inline-block; width: 12px; height: 12px; background: #5cb85c; border-radius: 50%;"></span>
                        <span style="color: #5cb85c; font-weight: bold;">Online</span>
                        <span id="github-status-token" style="display: inline-block; width: 12px; height: 12px; background: #5cb85c; border-radius: 50%; margin-left: 20px;"></span>
                        <span id="github-status-token-text" style="color: #5cb85c; font-weight: bold;">Token v√°lido</span>
                    </div>
                    
                    <h3 style="margin: 0 0 16px 0; color: #333;">‚öôÔ∏è Configura√ß√£o GitHub</h3>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: bold;">Token GitHub (para upload de imagens):</label>
                        <input type="password" id="github-token-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                               style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
                    </div>
                    
                    <button onclick="saveGitHubToken()" style="background: #f39c12; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: bold;">
                        Salvar Token
                    </button>
                    
                    <div style="background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 4px; padding: 16px; margin-top: 16px;">
                        <h4 style="margin: 0 0 8px 0; color: #333;">Como funciona a sincroniza√ß√£o:</h4>
                        <ul style="margin: 8px 0; padding-left: 20px; color: #666;">
                            <li>Configure o token UMA √öNICA VEZ neste dispositivo</li>
                            <li>Todos os dispositivos ver√£o automaticamente os produtos</li>
                            <li>Clientes N√ÉO precisam configurar nada</li>
                            <li>Imagens ficam dispon√≠veis para todos automaticamente</li>
                        </ul>
                        
                        <p style="margin: 8px 0 0 0; color: #666; font-size: 14px;">
                            <strong>Token necess√°rio para fazer upload de imagens para o reposit√≥rio GitHub</strong><br>
                            <span style="color: #e74c3c;">Token carregado do armazenamento local</span>
                        </p>
                    </div>
                </div>

                <!-- System Status -->
                <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px;">
                    <h3 style="margin: 0 0 16px 0; color: #333;">Status do Sistema</h3>
                    <table class="data-table">
                        <tbody>
                            <tr>
                                <td><strong>Plataforma</strong></td>
                                <td>GitHub Pages</td>
                            </tr>
                            <tr>
                                <td><strong>Modo de Opera√ß√£o</strong></td>
                                <td>Somente Leitura (JSON Est√°tico)</td>
                            </tr>
                            <tr>
                                <td><strong>Autentica√ß√£o</strong></td>
                                <td>Local (SessionStorage)</td>
                            </tr>
                            <tr>
                                <td><strong>Armazenamento</strong></td>
                                <td>Arquivos JSON no GitHub</td>
                            </tr>
                            <tr>
                                <td><strong>Performance</strong></td>
                                <td><span style="color: #5cb85c;">‚úì √ìtima (CDN Global)</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Adicionar Produto</h3>
                <button class="close-btn" onclick="closeModal('product-modal')">&times;</button>
            </div>
            <form id="product-form">
                <div class="form-group">
                    <label class="form-label">Nome do Produto</label>
                    <input type="text" class="form-input" id="product-name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Categoria</label>
                    <select class="form-select" id="product-category" required>
                        <option value="">Selecione uma categoria</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Pre√ßo √† Vista (R$)</label>
                    <input type="number" class="form-input" id="product-price" step="0.01" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Imagem do Produto</label>
                    <input type="file" class="form-input" id="product-image" accept="image/*" onchange="handleImageUpload(event, 'product')">
                    <small style="color: #666;">Formatos aceitos: JPG, PNG, WebP (m√°x. 2MB)</small>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeModal('product-modal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="category-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Adicionar Categoria</h3>
                <button class="close-btn" onclick="closeModal('category-modal')">&times;</button>
            </div>
            <form id="category-form">
                <div class="form-group">
                    <label class="form-label">Nome da Categoria</label>
                    <input type="text" class="form-input" id="category-name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <input type="text" class="form-input" id="category-description">
                </div>
                <div class="form-group">
                    <label class="form-label">Cor</label>
                    <input type="color" class="form-input" id="category-color" value="#4a90e2">
                </div>
                <div class="form-group">
                    <label class="form-label">Imagem da Categoria</label>
                    <input type="file" class="form-input" id="category-image" accept="image/*" onchange="handleImageUpload(event, 'category')">
                    <small style="color: #666;">Formatos aceitos: JPG, PNG, WebP (m√°x. 2MB)</small>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeModal('category-modal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- User Modal -->
    <div id="user-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Adicionar Usu√°rio</h3>
                <button class="close-btn" onclick="closeModal('user-modal')">&times;</button>
            </div>
            <form id="user-form">
                <div class="form-group">
                    <label class="form-label">Nome</label>
                    <input type="text" class="form-input" id="user-name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-input" id="user-username" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Senha</label>
                    <input type="password" class="form-input" id="user-password" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Fun√ß√£o</label>
                    <select class="form-select" id="user-role" required>
                        <option value="">Selecione uma fun√ß√£o</option>
                        <option value="admin">Administrador</option>
                        <option value="loja">Loja</option>
                        <option value="restaurante">Restaurante</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Multiplicador de Pre√ßo</label>
                    <input type="number" class="form-input" id="user-multiplier" step="0.01" value="1.00" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeModal('user-modal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // GitHub Pages Admin Client
        class AdminClient {
            constructor() {
                this.baseUrl = window.location.origin + window.location.pathname.replace('/admin.html', '');
                this.data = {
                    products: [],
                    categories: [],
                    users: [],
                    priceSettings: [],
                    promotions: []
                };
            }

            async loadData(filename) {
                try {
                    // Try to load from GitHub first
                    const response = await fetch(`${this.baseUrl}/data/${filename}`);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    return await response.json();
                } catch (error) {
                    console.log(`GitHub data unavailable for ${filename}, checking localStorage...`);
                    
                    // Fallback to localStorage
                    const dataType = filename.replace('.json', '').replace('_', '');
                    const localKey = `moveisbonafe_${dataType === 'pricesettings' ? 'priceSettings' : dataType}`;
                    const localData = localStorage.getItem(localKey);
                    
                    if (localData) {
                        console.log(`Loaded ${filename} from localStorage`);
                        return JSON.parse(localData);
                    }
                    
                    console.error(`No data found for ${filename} in GitHub or localStorage`);
                    return [];
                }
            }

            async init() {
                // Check authentication
                const userSession = sessionStorage.getItem('currentUser');
                if (!userSession) {
                    window.location.href = 'login.html';
                    return;
                }

                const user = JSON.parse(userSession);
                if (user.role !== 'admin') {
                    alert('Acesso negado. Apenas administradores podem acessar esta √°rea.');
                    window.location.href = 'login.html';
                    return;
                }

                await this.loadAllData();
                this.renderProducts();
                this.renderCategories();
                this.renderUsers();
                this.renderPriceSettings();
                this.renderPromotions();
                this.updateMonitorData();
            }

            async loadAllData() {
                try {
                    // First, load from localStorage (most recent changes)
                    const localProducts = localStorage.getItem('moveisbonafe_products');
                    const localCategories = localStorage.getItem('moveisbonafe_categories');
                    const localUsers = localStorage.getItem('moveisbonafe_users');
                    const localPriceSettings = localStorage.getItem('moveisbonafe_price_settings');
                    const localPromotions = localStorage.getItem('moveisbonafe_promotions');

                    // If localStorage has data, use it (preserves deletions and edits)
                    if (localProducts) {
                        this.data.products = JSON.parse(localProducts);
                        console.log(`üì¶ Carregado ${this.data.products.length} produtos do localStorage`);
                    } else {
                        const products = await this.loadData('products.json');
                        this.data.products = products || [];
                    }

                    if (localCategories) {
                        this.data.categories = JSON.parse(localCategories);
                    } else {
                        const categories = await this.loadData('categories.json');
                        this.data.categories = categories || [];
                    }

                    if (localUsers) {
                        this.data.users = JSON.parse(localUsers);
                    } else {
                        const users = await this.loadData('users.json');
                        this.data.users = users || [];
                    }

                    if (localPriceSettings) {
                        this.data.priceSettings = JSON.parse(localPriceSettings);
                    } else {
                        const priceSettings = await this.loadData('price_settings.json');
                        this.data.priceSettings = priceSettings || [];
                    }

                    if (localPromotions) {
                        this.data.promotions = JSON.parse(localPromotions);
                    } else {
                        const promotions = await this.loadData('promotions.json');
                        this.data.promotions = promotions || [];
                    }

                    console.log(`‚úÖ Dados carregados: ${this.data.products.length} produtos, ${this.data.categories.length} categorias, ${this.data.users.length} usu√°rios, ${this.data.priceSettings.length} tabelas de pre√ßo, ${this.data.promotions.length} promo√ß√µes`);
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                }
            }

            renderProducts() {
                const loading = document.getElementById('produtos-loading');
                const content = document.getElementById('produtos-content');
                const table = document.getElementById('produtos-table');
                const empty = document.getElementById('produtos-empty');

                loading.style.display = 'none';
                content.style.display = 'block';

                if (this.data.products.length === 0) {
                    table.style.display = 'none';
                    empty.style.display = 'block';
                    return;
                }

                empty.style.display = 'none';
                table.innerHTML = '';

                this.data.products.forEach((product, index) => {
                    const row = table.insertRow();
                    const basePrice = product.priceAVista || product.basePrice || product.finalPrice || 0;
                    
                    // Generate product image display
                    let imageCell = '<div class="product-image-cell">üì¶</div>';
                    if (product.imageFile) {
                        let imageSrc = product.imageFile;
                        
                        // Check if it's a local storage reference
                        if (!imageSrc.startsWith('data:') && !imageSrc.startsWith('http')) {
                            const storedImage = localStorage.getItem(`image_${imageSrc}`);
                            if (storedImage) {
                                imageSrc = storedImage;
                            }
                        }
                        
                        imageCell = `
                            <div class="product-image-cell">
                                <img src="${imageSrc}" 
                                     alt="${product.name}" 
                                     style="width: 50px; height: 50px; object-fit: cover; border-radius: 6px; border: 1px solid #ddd;">
                            </div>
                        `;
                    }
                    
                    row.innerHTML = `
                        <td>${imageCell}</td>
                        <td><strong>${product.name || 'Sem nome'}</strong><br><small>${product.category || 'Sem categoria'}</small></td>
                        <td class="price-cell">R$ ${basePrice.toFixed(2)}</td>
                        <td class="price-cell">R$ ${(basePrice * 1.1).toFixed(2)}</td>
                        <td class="price-cell">R$ ${(basePrice * 1.15).toFixed(2)}</td>
                        <td class="price-cell">R$ ${(basePrice * 1.2).toFixed(2)}</td>
                        <td class="price-cell">R$ ${(basePrice * 1.25).toFixed(2)}</td>
                        <td class="action-buttons-cell">
                            <button class="btn btn-edit btn-sm" onclick="editProduct(${index})">‚úèÔ∏è</button>
                            <button class="btn btn-delete btn-sm" onclick="deleteProduct(${index})">üóëÔ∏è</button>
                        </td>
                    `;
                });
            }

            renderCategories() {
                const loading = document.getElementById('categorias-loading');
                const content = document.getElementById('categorias-content');
                const table = document.getElementById('categorias-table');

                loading.style.display = 'none';
                content.style.display = 'block';
                table.innerHTML = '';

                this.data.categories.forEach((category, index) => {
                    const productCount = this.data.products.filter(p => p.category === category.name).length;
                    const row = table.insertRow();
                    
                    row.innerHTML = `
                        <td><strong>${category.name || 'Sem nome'}</strong></td>
                        <td>${category.description || 'Sem descri√ß√£o'}</td>
                        <td><span style="background: ${category.color || '#ccc'}; padding: 4px 8px; border-radius: 4px; color: white;">${category.color || 'N/A'}</span></td>
                        <td>${productCount} produtos</td>
                        <td class="action-buttons-cell">
                            <button class="btn btn-edit btn-sm" onclick="editCategory(${index})">‚úèÔ∏è</button>
                            <button class="btn btn-delete btn-sm" onclick="deleteCategory(${index})">üóëÔ∏è</button>
                        </td>
                    `;
                });

                // Update product category dropdown
                const categorySelect = document.getElementById('product-category');
                categorySelect.innerHTML = '<option value="">Selecione uma categoria</option>';
                this.data.categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.name;
                    option.textContent = category.name;
                    categorySelect.appendChild(option);
                });
            }

            renderUsers() {
                const loading = document.getElementById('usuarios-loading');
                const content = document.getElementById('usuarios-content');
                const table = document.getElementById('usuarios-table');

                loading.style.display = 'none';
                content.style.display = 'block';
                table.innerHTML = '';

                this.data.users.forEach((user, index) => {
                    const row = table.insertRow();
                    const isActive = user.active !== false;
                    
                    row.innerHTML = `
                        <td><strong>${user.name || 'Sem nome'}</strong></td>
                        <td>${user.username || 'Sem username'}</td>
                        <td>${user.role || 'Sem fun√ß√£o'}</td>
                        <td>${(user.priceMultiplier || 1.0).toFixed(2)}x</td>
                        <td><span style="background: ${isActive ? '#5cb85c' : '#e74c3c'}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">${isActive ? 'Ativo' : 'Inativo'}</span></td>
                        <td class="action-buttons-cell">
                            <button class="btn btn-edit btn-sm" onclick="editUser(${index})">‚úèÔ∏è</button>
                            <button class="btn btn-delete btn-sm" onclick="deleteUser(${index})">üóëÔ∏è</button>
                        </td>
                    `;
                });
            }

            renderPriceSettings() {
                const loading = document.getElementById('precos-loading');
                const content = document.getElementById('precos-content');
                const table = document.getElementById('precos-table');

                loading.style.display = 'none';
                content.style.display = 'block';
                table.innerHTML = '';

                this.data.priceSettings.forEach((setting, index) => {
                    const row = table.insertRow();
                    const multiplier = (1 + (setting.percentage / 100)).toFixed(3);
                    const example = (100 * multiplier).toFixed(2);
                    
                    row.innerHTML = `
                        <td><strong>${setting.tableName}</strong></td>
                        <td>${setting.percentage.toFixed(1)}%</td>
                        <td>${multiplier}x</td>
                        <td class="price-cell">R$ ${example}</td>
                        <td class="action-buttons-cell">
                            <button class="btn btn-edit btn-sm" onclick="editPriceSetting(${index})">‚úèÔ∏è</button>
                            <button class="btn btn-delete btn-sm" onclick="deletePriceSetting(${index})">üóëÔ∏è</button>
                        </td>
                    `;
                });
            }

            renderPromotions() {
                const loading = document.getElementById('promocoes-loading');
                const content = document.getElementById('promocoes-content');
                const table = document.getElementById('promocoes-table');

                loading.style.display = 'none';
                content.style.display = 'block';
                table.innerHTML = '';

                this.data.promotions.forEach((promotion, index) => {
                    const row = table.insertRow();
                    const isActive = promotion.active === true;
                    
                    row.innerHTML = `
                        <td><strong>${promotion.title || 'Sem t√≠tulo'}</strong></td>
                        <td>${promotion.description || 'Sem descri√ß√£o'}</td>
                        <td><span style="background: ${promotion.color || '#f39c12'}; padding: 4px 8px; border-radius: 4px; color: white;">${promotion.color || 'N/A'}</span></td>
                        <td><span style="background: ${isActive ? '#5cb85c' : '#e74c3c'}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">${isActive ? 'Ativa' : 'Inativa'}</span></td>
                        <td class="action-buttons-cell">
                            <button class="btn btn-edit btn-sm" onclick="editPromotion(${index})">‚úèÔ∏è</button>
                            <button class="btn btn-delete btn-sm" onclick="deletePromotion(${index})">üóëÔ∏è</button>
                        </td>
                    `;
                });
            }

            updateMonitorData() {
                // Update monitor statistics
                const activeProducts = this.data.products.filter(p => p.active !== false).length;
                const activeUsers = this.data.users.filter(u => u.active !== false).length;
                const activePromotions = this.data.promotions.filter(p => p.active === true).length;

                document.getElementById('monitor-products').textContent = activeProducts;
                document.getElementById('monitor-categories').textContent = this.data.categories.length;
                document.getElementById('monitor-users').textContent = activeUsers;
                document.getElementById('monitor-promotions').textContent = activePromotions;

                // Update backup info
                const totalRecords = this.data.products.length + this.data.categories.length + this.data.users.length + this.data.priceSettings.length + this.data.promotions.length;
                const dataSize = JSON.stringify(this.data).length;

                document.getElementById('total-records').textContent = totalRecords.toLocaleString();
                document.getElementById('data-size').textContent = (dataSize / 1024).toFixed(1) + ' KB';
                document.getElementById('last-backup-date').textContent = new Date().toLocaleString('pt-BR');
            }

            // GitHub API Integration
            async saveToGitHub(filename, data) {
                const token = localStorage.getItem('github_token');
                if (!token) {
                    this.requestGitHubToken();
                    return false;
                }

                try {
                    // Buscar SHA atual do arquivo
                    const sha = await this.getFileSHA(filename, token);
                    
                    // Preparar conte√∫do com codifica√ß√£o UTF-8 correta para portugu√™s brasileiro
                    const jsonContent = JSON.stringify(data, null, 2);
                    const utf8Bytes = new TextEncoder().encode(jsonContent);
                    const encodedContent = btoa(String.fromCharCode(...utf8Bytes));
                    
                    const requestBody = {
                        message: `Update ${filename} via admin panel - ${new Date().toISOString()}`,
                        content: encodedContent
                    };
                    
                    // Adicionar SHA se arquivo existe
                    if (sha) {
                        requestBody.sha = sha;
                    }

                    const response = await fetch(`https://api.github.com/repos/${this.getRepoPath()}/contents/docs/data/${filename}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json',
                            'Accept': 'application/vnd.github.v3+json'
                        },
                        body: JSON.stringify(requestBody)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        console.log(`‚úÖ ${filename} salvo no GitHub (SHA: ${result.content.sha.substring(0,8)})`);
                        return true;
                    } else {
                        const errorData = await response.json();
                        console.error(`‚ùå GitHub API Error ${response.status}:`, errorData);
                        throw new Error(`GitHub API error: ${response.status} - ${errorData.message}`);
                    }
                } catch (error) {
                    console.error(`‚ùå Erro ao salvar no GitHub:`, error);
                    return false;
                }
            }

            async getFileSHA(filename, token) {
                try {
                    const response = await fetch(`https://api.github.com/repos/${this.getRepoPath()}/contents/docs/data/${filename}`, {
                        headers: { 
                            'Authorization': `Bearer ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Cache-Control': 'no-cache'
                        }
                    });
                    if (response.ok) {
                        const data = await response.json();
                        console.log(`üìÅ SHA atual: ${data.sha.substring(0,8)} para ${filename}`);
                        return data.sha;
                    } else if (response.status === 404) {
                        console.log(`üìÑ Arquivo ${filename} n√£o existe, ser√° criado`);
                        return null;
                    } else {
                        console.error(`Erro ao buscar SHA: ${response.status}`);
                        return null;
                    }
                } catch (error) {
                    console.log(`Erro ao verificar arquivo ${filename}:`, error);
                    return null;
                }
            }

            getRepoPath() {
                // Extract repository path from current URL
                const hostname = window.location.hostname;
                const pathname = window.location.pathname;
                
                if (hostname.includes('github.io')) {
                    const parts = hostname.split('.');
                    const username = parts[0];
                    
                    // For GitHub Pages, repository name is in pathname
                    const pathParts = pathname.split('/').filter(p => p);
                    const repoName = pathParts[0] || username + '.github.io';
                    
                    console.log(`üîó Detectado reposit√≥rio: ${username}/${repoName}`);
                    return `${username}/${repoName}`;
                }
                
                // Fallback para desenvolvimento local/Replit
                console.log('üîó Usando reposit√≥rio padr√£o para desenvolvimento');
                return 'moveisbonafe/TabelaPrecoMoveisBonafe';
            }

            base64EncodeUTF8(str) {
                // Properly encode UTF-8 strings for GitHub API
                return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, function(match, p1) {
                    return String.fromCharCode('0x' + p1);
                }));
            }

            requestGitHubToken() {
                const token = prompt(`Para salvar dados no GitHub, insira seu Personal Access Token:

1. V√° para GitHub.com ‚Üí Settings ‚Üí Developer settings ‚Üí Personal access tokens
2. Generate new token (classic)
3. Selecione escopo 'repo'
4. Cole o token abaixo:

O token ser√° salvo localmente no navegador.`);

                if (token) {
                    localStorage.setItem('github_token', token);
                    alert('Token GitHub salvo com sucesso!');
                } else {
                    alert('Token necess√°rio para salvar altera√ß√µes.');
                }
            }

            saveData(type, data) {
                this.data[type] = data;
                
                // Sempre salvar no localStorage primeiro para persist√™ncia imediata
                localStorage.setItem(`moveisbonafe_${type}`, JSON.stringify(data));
                
                // Notificar outros dispositivos sobre a mudan√ßa
                this.notifyDataChange(type, data);
                
                // Tentar salvar no GitHub se token dispon√≠vel
                const token = localStorage.getItem('github_token');
                if (token) {
                    const filename = `${type}.json`;
                    this.saveToGitHub(filename, data).then(success => {
                        if (success) {
                            console.log(`‚úÖ ${type} salvo no GitHub`);
                        } else {
                            console.log(`‚ùå Erro ao salvar ${type} no GitHub, mantido localmente`);
                        }
                    });
                } else {
                    console.log(`${type} salvo apenas localmente (token GitHub n√£o configurado)`);
                }
            }

            notifyDataChange(type, data) {
                // Disparar evento customizado para notificar mudan√ßas
                const timestamp = Date.now();
                localStorage.setItem(`moveisbonafe_sync_${type}`, timestamp.toString());
                
                // Evento de mudan√ßa para sincroniza√ß√£o cross-tab
                window.dispatchEvent(new CustomEvent('moveisbonafe_data_update', {
                    detail: { type, data, timestamp }
                }));
                
                console.log(`üì¢ Notifica√ß√£o enviada: ${type} atualizado`);
            }
        }

        // Global variables
        let adminClient;

        // Tab management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        }

        // Modal management
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('active');
            
            // Clear form data and datasets when closing
            if (modalId === 'product-modal') {
                const form = document.getElementById('product-form');
                form.reset();
                delete form.dataset.imageFile;
                delete modal.dataset.editIndex;
                const preview = document.getElementById('product-image-preview');
                if (preview) preview.innerHTML = '';
            } else if (modalId === 'category-modal') {
                const form = document.getElementById('category-form');
                form.reset();
                delete form.dataset.imageFile;
                delete modal.dataset.editIndex;
                const preview = document.getElementById('category-image-preview');
                if (preview) preview.innerHTML = '';
            } else if (modalId === 'user-modal') {
                const form = document.getElementById('user-form');
                form.reset();
                delete modal.dataset.editIndex;
            }
        }

        function openProductModal(productIndex = null) {
            const modal = document.getElementById('product-modal');
            const title = document.querySelector('#product-modal .modal-title');
            
            if (productIndex !== null) {
                title.textContent = 'Editar Produto';
                const product = adminClient.data.products[productIndex];
                document.getElementById('product-name').value = product.name || '';
                document.getElementById('product-category').value = product.category || '';
                document.getElementById('product-price').value = product.priceAVista || product.basePrice || 0;
                modal.dataset.editIndex = productIndex;
            } else {
                title.textContent = 'Adicionar Produto';
                document.getElementById('product-form').reset();
                delete modal.dataset.editIndex;
            }
            
            openModal('product-modal');
        }

        function openCategoryModal(categoryIndex = null) {
            const modal = document.getElementById('category-modal');
            const title = document.querySelector('#category-modal .modal-title');
            
            if (categoryIndex !== null) {
                title.textContent = 'Editar Categoria';
                const category = adminClient.data.categories[categoryIndex];
                document.getElementById('category-name').value = category.name || '';
                document.getElementById('category-description').value = category.description || '';
                document.getElementById('category-color').value = category.color || '#4a90e2';
                modal.dataset.editIndex = categoryIndex;
            } else {
                title.textContent = 'Adicionar Categoria';
                document.getElementById('category-form').reset();
                delete modal.dataset.editIndex;
            }
            
            openModal('category-modal');
        }

        function openUserModal(userIndex = null) {
            const modal = document.getElementById('user-modal');
            const title = document.querySelector('#user-modal .modal-title');
            
            if (userIndex !== null) {
                title.textContent = 'Editar Usu√°rio';
                const user = adminClient.data.users[userIndex];
                document.getElementById('user-name').value = user.name || '';
                document.getElementById('user-username').value = user.username || '';
                document.getElementById('user-password').value = user.passwordHash || '';
                document.getElementById('user-role').value = user.role || '';
                document.getElementById('user-multiplier').value = user.priceMultiplier || 1.0;
                modal.dataset.editIndex = userIndex;
            } else {
                title.textContent = 'Adicionar Usu√°rio';
                document.getElementById('user-form').reset();
                document.getElementById('user-multiplier').value = '1.00';
                delete modal.dataset.editIndex;
            }
            
            openModal('user-modal');
        }

        // CRUD operations (GitHub Pages limitation - read-only)
        function editProduct(index) {
            openProductModal(index);
        }

        function deleteProduct(index) {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                // Get the product being deleted
                const productToDelete = adminClient.data.products[index];
                console.log(`üóëÔ∏è Deletando produto: ${productToDelete.name}`);
                
                // Remove from data array
                adminClient.data.products.splice(index, 1);
                
                // Save immediately to localStorage and GitHub
                adminClient.saveData('products', adminClient.data.products);
                
                // Re-render the table
                adminClient.renderProducts();
                
                // Add log for monitoring
                addSystemLog(`Produto "${productToDelete.name}" deletado`);
                
                console.log(`‚úÖ Produto deletado. Total restante: ${adminClient.data.products.length}`);
            }
        }

        function editCategory(index) {
            openCategoryModal(index);
        }

        function deleteCategory(index) {
            if (confirm('Tem certeza que deseja excluir esta categoria?')) {
                adminClient.data.categories.splice(index, 1);
                adminClient.saveData('categories', adminClient.data.categories);
                adminClient.renderCategories();
            }
        }

        function editUser(index) {
            openUserModal(index);
        }

        function deleteUser(index) {
            if (confirm('Tem certeza que deseja excluir este usu√°rio?')) {
                adminClient.data.users.splice(index, 1);
                adminClient.saveData('users', adminClient.data.users);
                adminClient.renderUsers();
            }
        }

        // Excel and File Operations
        function handleExcelUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                alert('Para importar arquivos Excel (.xlsx):\n\n1. Abra o arquivo no Excel\n2. V√° em "Arquivo" ‚Üí "Salvar como"\n3. Escolha formato "CSV (separado por v√≠rgulas)"\n4. Importe o arquivo CSV gerado\n\nOu use nosso modelo CSV para criar novos produtos.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = e.target.result;
                    if (file.name.endsWith('.csv')) {
                        parseCSVData(data);
                    } else {
                        alert('Formato suportado: CSV\nPara arquivos Excel, primeiro converta para CSV.');
                    }
                } catch (error) {
                    console.error('Erro ao processar arquivo:', error);
                    alert('Erro ao processar arquivo. Verifique o formato.');
                }
            };
            // Use UTF-8 encoding for proper character handling
            reader.readAsText(file, 'UTF-8');
        }

        function parseCSVData(csvData) {
            const lines = csvData.split('\n').filter(line => line.trim());
            if (lines.length < 2) {
                alert('Arquivo vazio ou inv√°lido.');
                return;
            }
            
            // Auto-detect separator (tab or comma)
            let separator = ',';
            if (lines[0].includes('\t')) {
                separator = '\t';
            }
            
            const headers = lines[0].split(separator).map(h => h.trim());
            const expectedHeaders = ['Nome', 'Categoria', 'Pre√ßo', 'Altura', 'Largura', 'Comprimento', 'Peso', 'Descri√ß√£o'];
            
            // Check if headers match (case insensitive)
            const headerMap = {};
            headers.forEach((header, index) => {
                const normalizedHeader = header.trim().toLowerCase();
                expectedHeaders.forEach(expected => {
                    if (normalizedHeader === expected.toLowerCase()) {
                        headerMap[expected] = index;
                    }
                });
            });
            
            if (Object.keys(headerMap).length < 3) {
                alert('Formato inv√°lido. Certifique-se que o arquivo cont√©m pelo menos: Nome, Categoria, Pre√ßo');
                return;
            }

            const products = [];
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(separator).map(v => v.trim());
                
                const name = values[headerMap['Nome']]?.trim();
                if (!name) continue; // Skip empty rows
                
                products.push({
                    id: Date.now() + i,
                    name: name,
                    category: values[headerMap['Categoria']]?.trim() || 'Geral',
                    priceAVista: parseFloat(values[headerMap['Pre√ßo']]?.replace(',', '.')) || 0,
                    altura: parseFloat(values[headerMap['Altura']]?.replace(',', '.')) || 0,
                    largura: parseFloat(values[headerMap['Largura']]?.replace(',', '.')) || 0,
                    comprimento: parseFloat(values[headerMap['Comprimento']]?.replace(',', '.')) || 0,
                    peso: parseFloat(values[headerMap['Peso']]?.replace(',', '.')) || 0,
                    description: values[headerMap['Descri√ß√£o']]?.trim() || '',
                    active: true,
                    createdAt: new Date().toISOString()
                });
            }

            if (products.length > 0) {
                adminClient.data.products = [...adminClient.data.products, ...products];
                adminClient.saveData('products', adminClient.data.products);
                adminClient.renderProducts();
                alert(`${products.length} produtos importados com sucesso!`);
                addSystemLog(`${products.length} produtos importados via CSV`);
            } else {
                alert('Nenhum produto v√°lido encontrado no arquivo.');
            }
        }

        function exportToCSV() {
            // Create proper Excel format with tab separation
            const headers = ['Nome', 'Categoria', 'Preco', 'Altura', 'Largura', 'Comprimento', 'Peso', 'Descricao'];
            const rows = [headers];

            adminClient.data.products.forEach(product => {
                rows.push([
                    product.name || '',
                    product.category || '',
                    product.priceAVista || 0,
                    product.altura || 0,
                    product.largura || 0,
                    product.comprimento || 0,
                    product.peso || 0,
                    product.description || ''
                ]);
            });

            // Convert to proper tab-separated format
            const csvContent = rows.map(row => row.join('\t')).join('\n');
            
            // Add BOM for proper Excel UTF-8 support
            const blob = new Blob(['\ufeff' + csvContent], { 
                type: 'text/tab-separated-values;charset=utf-8;' 
            });
            
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `produtos-moveisbonafe-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            addSystemLog('Produtos exportados para Excel');
        }

        function downloadBackup() {
            const backup = {
                timestamp: new Date().toISOString(),
                version: '1.0',
                data: adminClient.data
            };

            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `moveisbonafe_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function handleBackupRestore(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    if (backup.data) {
                        if (confirm('Isso substituir√° todos os dados atuais. Continuar?')) {
                            adminClient.data = backup.data;
                            // Save all data types
                            Object.keys(adminClient.data).forEach(type => {
                                adminClient.saveData(type, adminClient.data[type]);
                            });
                            location.reload();
                        }
                    } else {
                        alert('Arquivo de backup inv√°lido.');
                    }
                } catch (error) {
                    console.error('Erro ao restaurar backup:', error);
                    alert('Erro ao processar backup. Verifique o arquivo.');
                }
            };
            reader.readAsText(file);
        }

        // Price Settings Functions
        function openPriceModal(index = null) {
            // Create price modal if it doesn't exist
            if (!document.getElementById('price-modal')) {
                const modalHTML = `
                    <div id="price-modal" class="modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3 class="modal-title">Adicionar Tabela de Pre√ßo</h3>
                                <button class="close-btn" onclick="closeModal('price-modal')">&times;</button>
                            </div>
                            <form id="price-form">
                                <div class="form-group">
                                    <label class="form-label">Nome da Tabela</label>
                                    <input type="text" class="form-input" id="price-name" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Percentual (%)</label>
                                    <input type="number" class="form-input" id="price-percentage" step="0.1" required>
                                </div>
                                <div class="form-actions">
                                    <button type="button" class="btn btn-cancel" onclick="closeModal('price-modal')">Cancelar</button>
                                    <button type="submit" class="btn btn-primary">Salvar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', modalHTML);
                
                document.getElementById('price-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    savePriceSetting();
                });
            }

            const modal = document.getElementById('price-modal');
            const title = document.querySelector('#price-modal .modal-title');
            
            if (index !== null) {
                title.textContent = 'Editar Tabela de Pre√ßo';
                const setting = adminClient.data.priceSettings[index];
                document.getElementById('price-name').value = setting.tableName || '';
                document.getElementById('price-percentage').value = setting.percentage || 0;
                modal.dataset.editIndex = index;
            } else {
                title.textContent = 'Adicionar Tabela de Pre√ßo';
                document.getElementById('price-form').reset();
                delete modal.dataset.editIndex;
            }
            
            openModal('price-modal');
        }

        function savePriceSetting() {
            const modal = document.getElementById('price-modal');
            const isEdit = modal.dataset.editIndex !== undefined;
            const index = parseInt(modal.dataset.editIndex);

            const setting = {
                id: isEdit ? adminClient.data.priceSettings[index].id : Date.now().toString(),
                tableName: document.getElementById('price-name').value,
                percentage: parseFloat(document.getElementById('price-percentage').value),
                active: true,
                createdAt: isEdit ? adminClient.data.priceSettings[index].createdAt : new Date().toISOString()
            };

            if (isEdit) {
                adminClient.data.priceSettings[index] = setting;
            } else {
                adminClient.data.priceSettings.push(setting);
            }

            adminClient.saveData('priceSettings', adminClient.data.priceSettings);
            adminClient.renderPriceSettings();
            closeModal('price-modal');
        }

        function editPriceSetting(index) {
            openPriceModal(index);
        }

        function deletePriceSetting(index) {
            if (confirm('Tem certeza que deseja excluir esta tabela de pre√ßos?')) {
                adminClient.data.priceSettings.splice(index, 1);
                adminClient.saveData('priceSettings', adminClient.data.priceSettings);
                adminClient.renderPriceSettings();
            }
        }

        // Promotion Functions
        function openPromotionModal(index = null) {
            // Create promotion modal if it doesn't exist
            if (!document.getElementById('promotion-modal')) {
                const modalHTML = `
                    <div id="promotion-modal" class="modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3 class="modal-title">Adicionar Promo√ß√£o</h3>
                                <button class="close-btn" onclick="closeModal('promotion-modal')">&times;</button>
                            </div>
                            <form id="promotion-form">
                                <div class="form-group">
                                    <label class="form-label">Texto</label>
                                    <input type="text" class="form-input" id="promotion-title" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Descri√ß√£o</label>
                                    <textarea class="form-input" id="promotion-description" rows="3"></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Cor</label>
                                    <input type="color" class="form-input" id="promotion-color" value="#f39c12">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        <input type="checkbox" id="promotion-active"> Ativar promo√ß√£o
                                    </label>
                                </div>
                                <div class="form-actions">
                                    <button type="button" class="btn btn-cancel" onclick="closeModal('promotion-modal')">Cancelar</button>
                                    <button type="submit" class="btn btn-primary">Salvar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', modalHTML);
                
                document.getElementById('promotion-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    savePromotion();
                });
            }

            const modal = document.getElementById('promotion-modal');
            const title = document.querySelector('#promotion-modal .modal-title');
            
            if (index !== null) {
                title.textContent = 'Editar Promo√ß√£o';
                const promotion = adminClient.data.promotions[index];
                document.getElementById('promotion-title').value = promotion.title || '';
                document.getElementById('promotion-description').value = promotion.description || '';
                document.getElementById('promotion-color').value = promotion.color || '#f39c12';
                document.getElementById('promotion-active').checked = promotion.active === true;
                modal.dataset.editIndex = index;
            } else {
                title.textContent = 'Adicionar Promo√ß√£o';
                document.getElementById('promotion-form').reset();
                document.getElementById('promotion-color').value = '#f39c12';
                delete modal.dataset.editIndex;
            }
            
            openModal('promotion-modal');
        }

        function savePromotion() {
            const modal = document.getElementById('promotion-modal');
            const isEdit = modal.dataset.editIndex !== undefined;
            const index = parseInt(modal.dataset.editIndex);
            const isActive = document.getElementById('promotion-active').checked;

            // If activating this promotion, deactivate others
            if (isActive) {
                adminClient.data.promotions.forEach(p => p.active = false);
            }

            const promotion = {
                id: isEdit ? adminClient.data.promotions[index].id : Date.now().toString(),
                title: document.getElementById('promotion-title').value,
                description: document.getElementById('promotion-description').value,
                color: document.getElementById('promotion-color').value,
                active: isActive,
                createdAt: isEdit ? adminClient.data.promotions[index].createdAt : new Date().toISOString()
            };

            if (isEdit) {
                adminClient.data.promotions[index] = promotion;
            } else {
                adminClient.data.promotions.push(promotion);
            }

            adminClient.saveData('promotions', adminClient.data.promotions);
            adminClient.renderPromotions();
            adminClient.updateMonitorData();
            closeModal('promotion-modal');
        }

        function editPromotion(index) {
            openPromotionModal(index);
        }

        function deletePromotion(index) {
            if (confirm('Tem certeza que deseja excluir esta promo√ß√£o?')) {
                adminClient.data.promotions.splice(index, 1);
                adminClient.saveData('promotions', adminClient.data.promotions);
                adminClient.renderPromotions();
                adminClient.updateMonitorData();
            }
        }

        // Image Upload Functions
        function handleImageUpload(event, type) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate file
            if (file.size > 2 * 1024 * 1024) {
                alert('Arquivo muito grande. M√°ximo 2MB.');
                return;
            }

            if (!file.type.startsWith('image/')) {
                alert('Arquivo deve ser uma imagem.');
                return;
            }

            // For GitHub Pages, we'll save as base64 in the data
            const reader = new FileReader();
            reader.onload = function(e) {
                const base64 = e.target.result;
                
                if (type === 'product') {
                    // Store image reference for product
                    const fileName = `product_${Date.now()}.${file.name.split('.').pop()}`;
                    localStorage.setItem(`image_${fileName}`, base64);
                    
                    // Update form with image reference
                    const form = document.getElementById('product-form');
                    form.dataset.imageFile = fileName;
                    
                    // Show preview
                    showImagePreview(base64, 'product-image');
                } else if (type === 'category') {
                    const fileName = `category_${Date.now()}.${file.name.split('.').pop()}`;
                    localStorage.setItem(`image_${fileName}`, base64);
                    
                    const form = document.getElementById('category-form');
                    form.dataset.imageFile = fileName;
                    
                    showImagePreview(base64, 'category-image');
                }

                console.log(`Imagem ${fileName} salva localmente`);
            };
            reader.readAsDataURL(file);
        }

        function showImagePreview(base64, inputId) {
            const input = document.getElementById(inputId);
            let preview = input.parentNode.querySelector('.image-preview');
            
            if (!preview) {
                preview = document.createElement('div');
                preview.className = 'image-preview';
                preview.style.cssText = `
                    margin-top: 8px; 
                    max-width: 120px; 
                    max-height: 120px; 
                    overflow: hidden; 
                    border-radius: 8px; 
                    border: 2px solid #e0e0e0;
                    background: #f8f9fa;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                `;
                input.parentNode.insertBefore(preview, input.nextSibling);
            }
            
            preview.innerHTML = `<img src="${base64}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 6px;">`;
        }

        // Monitor tab real-time updates
        function startMonitorUpdates() {
            setInterval(() => {
                if (adminClient && document.querySelector('#monitor-tab.active')) {
                    adminClient.updateMonitorData();
                }
            }, 30000); // Update every 30 seconds
        }

        // System logs simulation for monitor
        function addSystemLog(message) {
            const logs = JSON.parse(localStorage.getItem('system_logs') || '[]');
            const timestamp = new Date().toLocaleString('pt-BR');
            logs.unshift(`${timestamp} - ${message}`);
            
            // Keep only last 50 logs
            if (logs.length > 50) {
                logs.splice(50);
            }
            
            localStorage.setItem('system_logs', JSON.stringify(logs));
        }

        // Handle image upload for products and categories
        function handleImageUpload(event, type) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validate file size (max 2MB)
            if (file.size > 2 * 1024 * 1024) {
                alert('Arquivo muito grande. Tamanho m√°ximo: 2MB');
                event.target.value = '';
                return;
            }
            
            // Validate file type
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png'];
            if (!validTypes.includes(file.type)) {
                alert('Formato inv√°lido. Use JPG ou PNG');
                event.target.value = '';
                return;
            }
            
            // Convert to base64 and store reference
            const reader = new FileReader();
            reader.onload = function(e) {
                const base64Data = e.target.result;
                const timestamp = Date.now();
                const extension = file.type === 'image/png' ? 'png' : 'jpg';
                const fileName = `${type}_${timestamp}.${extension}`;
                
                // Store image data for the form
                const form = document.getElementById(`${type}-form`);
                form.dataset.imageFile = fileName;
                form.dataset.imageData = base64Data;
                
                // Show preview
                showImagePreview(base64Data, type);
                
                addSystemLog(`Imagem ${fileName} preparada para upload`);
            };
            reader.readAsDataURL(file);
        }

        // Process image and upload to GitHub data/images folder
        async function processAndUploadImage(file, type) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = async function() {
                // Set canvas size for high quality
                const maxWidth = 1200;
                const maxHeight = 1200;
                let { width, height } = img;
                
                // Maintain aspect ratio
                if (width > height) {
                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }
                } else {
                    if (height > maxHeight) {
                        width = (width * maxHeight) / height;
                        height = maxHeight;
                    }
                }
                
                canvas.width = width;
                canvas.height = height;
                
                // Draw image with high quality settings
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';
                ctx.drawImage(img, 0, 0, width, height);
                
                // Convert to high quality format
                const imageFormat = file.type === 'image/png' ? 'image/png' : 'image/jpeg';
                const quality = imageFormat === 'image/jpeg' ? 0.9 : 1.0; // High quality JPEG or lossless PNG
                
                canvas.toBlob(async (blob) => {
                    const timestamp = Date.now();
                    const extension = imageFormat === 'image/png' ? 'png' : 'jpg';
                    const fileName = `${type}_${timestamp}.${extension}`;
                    
                    // Upload to GitHub data/images folder
                    const success = await uploadImageToGitHub(blob, fileName);
                    
                    if (success) {
                        const form = document.getElementById(`${type}-form`);
                        form.dataset.imageFile = `data/images/${fileName}`;
                        
                        // Show preview
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            showImagePreview(e.target.result, type);
                        };
                        reader.readAsDataURL(blob);
                        
                        alert('Imagem salva com sucesso!');
                        addSystemLog(`Imagem ${fileName} salva no GitHub`);
                    } else {
                        alert('Erro ao salvar imagem. Verifique o token GitHub.');
                    }
                }, imageFormat, quality);
            };
            
            const reader = new FileReader();
            reader.onload = function(e) {
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Upload image to GitHub data/images folder
        async function uploadImageToGitHub(base64Data, fileName) {
            const token = localStorage.getItem('github_token');
            if (!token) {
                alert('Token GitHub necess√°rio para salvar imagens');
                return false;
            }
            
            try {
                // Extract base64 data without data:image prefix
                const base64Content = base64Data.split(',')[1];
                
                const repoPath = adminClient.getRepoPath();
                const apiUrl = `https://api.github.com/repos/${repoPath}/contents/docs/data/images/${fileName}`;
                
                const response = await fetch(apiUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: `Add image ${fileName}`,
                        content: base64Content
                    })
                });
                
                if (response.ok) {
                    console.log(`‚úÖ Imagem ${fileName} salva no GitHub`);
                    return true;
                } else {
                    console.error(`‚ùå Erro ao salvar imagem: ${response.status}`);
                    return false;
                }
            } catch (error) {
                console.error('Erro ao fazer upload da imagem:', error);
                return false;
            }
        }
        
        function showImagePreview(base64Data, type) {
            const previewContainer = document.getElementById(`${type}-image-preview`) || createImagePreview(type);
            previewContainer.innerHTML = `
                <img src="${base64Data}" style="max-width: 100px; max-height: 100px; border-radius: 4px; border: 1px solid #ddd;">
                <button type="button" onclick="removeImagePreview('${type}')" style="margin-left: 10px; padding: 2px 8px; background: #dc3545; color: white; border: none; border-radius: 3px; cursor: pointer;">Remover</button>
            `;
        }
        
        function createImagePreview(type) {
            const container = document.createElement('div');
            container.id = `${type}-image-preview`;
            container.style.marginTop = '10px';
            
            const input = document.getElementById(`${type}-image`);
            input.parentNode.appendChild(container);
            
            return container;
        }
        
        function removeImagePreview(type) {
            const form = document.getElementById(`${type}-form`);
            delete form.dataset.imageFile;
            
            const preview = document.getElementById(`${type}-image-preview`);
            if (preview) preview.innerHTML = '';
            
            const input = document.getElementById(`${type}-image`);
            input.value = '';
        }

        // Configure GitHub Token with status update
        function configureGitHubToken() {
            const currentToken = localStorage.getItem('github_token');
            const message = currentToken ? 
                'Token GitHub j√° configurado. Deseja alterar?\n\nPara gerar um novo token:\n1. Acesse GitHub.com ‚Üí Settings ‚Üí Developer settings\n2. Personal access tokens ‚Üí Tokens (classic)\n3. Generate new token\n4. Selecione escopo "repo"\n\nNovo token:' :
                'Configure seu GitHub Token para salvar altera√ß√µes:\n\n1. Acesse GitHub.com ‚Üí Settings ‚Üí Developer settings\n2. Personal access tokens ‚Üí Tokens (classic)\n3. Generate new token\n4. Selecione escopo "repo"\n5. Cole o token abaixo:\n\nToken:';
            
            const token = prompt(message);
            
            if (token && token.trim()) {
                localStorage.setItem('github_token', token.trim());
                updateGitHubTokenStatus();
                alert('Token GitHub configurado com sucesso!\nAgora suas altera√ß√µes ser√£o salvas no GitHub.');
                addSystemLog('Token GitHub configurado');
            } else if (token === '') {
                localStorage.removeItem('github_token');
                updateGitHubTokenStatus();
                alert('Token GitHub removido. Altera√ß√µes ser√£o salvas apenas localmente.');
                addSystemLog('Token GitHub removido');
            }
        }

        function logout() {
            sessionStorage.removeItem('currentUser');
            window.location.href = 'login.html';
        }

        // Form submissions
        document.getElementById('product-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const modal = document.getElementById('product-modal');
            const isEdit = modal.dataset.editIndex !== undefined;
            const index = isEdit ? parseInt(modal.dataset.editIndex) : null;
            
            const product = {
                id: isEdit ? adminClient.data.products[index].id : Date.now().toString(),
                name: document.getElementById('product-name').value,
                category: document.getElementById('product-category').value,
                priceAVista: parseFloat(document.getElementById('product-price').value),
                active: true,
                createdAt: isEdit ? adminClient.data.products[index].createdAt : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // Preserve existing image if editing
            if (isEdit && adminClient.data.products[index].imageFile) {
                product.imageFile = adminClient.data.products[index].imageFile;
            }
            
            // Handle new image upload if present
            const form = document.getElementById('product-form');
            if (form.dataset.imageFile && form.dataset.imageData) {
                product.imageFile = `data/images/${form.dataset.imageFile}`;
                // Upload image to GitHub asynchronously
                uploadImageToGitHub(form.dataset.imageData, form.dataset.imageFile);
            }
            
            // Save product data immediately
            if (isEdit) {
                adminClient.data.products[index] = product;
            } else {
                adminClient.data.products.push(product);
            }
            
            // Persist data immediately
            adminClient.saveData('products', adminClient.data.products);
            adminClient.renderProducts();
            adminClient.updateMonitorData();
            closeModal('product-modal');
            
            addSystemLog(`${isEdit ? 'Editado' : 'Criado'} produto: ${product.name}`);
        });

        document.getElementById('category-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const modal = document.getElementById('category-modal');
            const isEdit = modal.dataset.editIndex !== undefined;
            const index = isEdit ? parseInt(modal.dataset.editIndex) : null;
            
            const category = {
                id: isEdit ? adminClient.data.categories[index].id : Date.now().toString(),
                name: document.getElementById('category-name').value,
                description: document.getElementById('category-description').value,
                color: document.getElementById('category-color').value,
                active: true,
                createdAt: isEdit ? adminClient.data.categories[index].createdAt : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // Preserve existing image if editing
            if (isEdit && adminClient.data.categories[index].imageFile) {
                category.imageFile = adminClient.data.categories[index].imageFile;
            }
            
            // Handle new image upload if present
            const form = document.getElementById('category-form');
            if (form.dataset.imageFile && form.dataset.imageData) {
                category.imageFile = `data/images/${form.dataset.imageFile}`;
                // Upload image to GitHub asynchronously
                uploadImageToGitHub(form.dataset.imageData, form.dataset.imageFile);
            }
            
            // Save category data immediately
            if (isEdit) {
                adminClient.data.categories[index] = category;
            } else {
                adminClient.data.categories.push(category);
            }
            
            // Persist data immediately
            adminClient.saveData('categories', adminClient.data.categories);
            adminClient.renderCategories();
            adminClient.updateMonitorData();
            closeModal('category-modal');
            
            addSystemLog(`${isEdit ? 'Editada' : 'Criada'} categoria: ${category.name}`);
        });

        document.getElementById('user-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const modal = document.getElementById('user-modal');
            const isEdit = modal.dataset.editIndex !== undefined;
            const index = isEdit ? parseInt(modal.dataset.editIndex) : null;
            
            const user = {
                id: isEdit ? adminClient.data.users[index].id : Date.now().toString(),
                name: document.getElementById('user-name').value,
                username: document.getElementById('user-username').value,
                passwordHash: document.getElementById('user-password').value,
                role: document.getElementById('user-role').value,
                priceMultiplier: parseFloat(document.getElementById('user-multiplier').value),
                active: true,
                createdAt: isEdit ? adminClient.data.users[index].createdAt : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            if (isEdit) {
                adminClient.data.users[index] = user;
            } else {
                adminClient.data.users.push(user);
            }
            
            adminClient.saveData('users', adminClient.data.users);
            adminClient.renderUsers();
            adminClient.updateMonitorData();
            closeModal('user-modal');
            
            addSystemLog(`${isEdit ? 'Editado' : 'Criado'} usu√°rio: ${user.name}`);
        });

        // Check GitHub token status and update button
        function updateGitHubTokenStatus() {
            const token = localStorage.getItem('github_token');
            const button = document.getElementById('github-token-btn');
            
            if (token) {
                button.style.background = '#28a745';
                button.style.color = 'white';
                button.innerHTML = '‚úÖ GitHub Configurado';
                button.title = 'Token GitHub configurado - Clique para alterar';
            } else {
                button.style.background = '#dc3545';
                button.style.color = 'white';
                button.innerHTML = '‚ö†Ô∏è Configurar GitHub Token';
                button.title = 'IMPORTANTE: Configure o token para salvar altera√ß√µes';
            }
            
            // Update monitor tab status indicators
            updateMonitorTokenStatus();
        }

        // Update token status in Monitor tab
        function updateMonitorTokenStatus() {
            const token = localStorage.getItem('github_token');
            const statusDot = document.getElementById('github-status-token');
            const statusText = document.getElementById('github-status-token-text');
            const tokenInput = document.getElementById('github-token-input');
            
            if (statusDot && statusText) {
                if (token) {
                    statusDot.style.background = '#5cb85c';
                    statusText.textContent = 'Token v√°lido';
                    statusText.style.color = '#5cb85c';
                    if (tokenInput) {
                        tokenInput.placeholder = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢ (Configurado)';
                    }
                } else {
                    statusDot.style.background = '#e74c3c';
                    statusText.textContent = 'Token n√£o configurado';
                    statusText.style.color = '#e74c3c';
                    if (tokenInput) {
                        tokenInput.placeholder = 'Cole seu token GitHub aqui';
                    }
                }
            }
        }

        // Save GitHub token from Monitor tab
        function saveGitHubToken() {
            const input = document.getElementById('github-token-input');
            const token = input.value.trim();
            
            if (token) {
                localStorage.setItem('github_token', token);
                input.value = '';
                updateGitHubTokenStatus();
                alert('Token GitHub salvo com sucesso!');
                addSystemLog('Token GitHub configurado via Monitor');
            } else {
                alert('Por favor, insira um token v√°lido.');
            }
        }

        // Initialize application
        document.addEventListener('DOMContentLoaded', () => {
            adminClient = new AdminClient();
            adminClient.init().catch(error => {
                console.error('Erro na inicializa√ß√£o:', error);
            });
            
            // Start monitor updates
            startMonitorUpdates();
            
            // Update GitHub token status
            updateGitHubTokenStatus();
            
            // Add initial system log
            addSystemLog('Sistema inicializado');
        });

        console.log('MoveisBonafe Admin Panel - GitHub Pages');
        console.log('Sistema: GitHub API integrado com fallback localStorage');
    </script>
</body>
</html>